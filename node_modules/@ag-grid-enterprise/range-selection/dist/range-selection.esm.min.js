/**
 * @ag-grid-enterprise/range-selection - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/range-selection - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
import{Events as e,_ as t,Constants as n,Autowired as i,PostConstruct as o,Bean as r,BeanStub as s,SelectionHandleType as l,Component as a,CellRangeType as c,ModuleNames as g}from"@ag-grid-community/core";import{EnterpriseCoreModule as d}from"@ag-grid-enterprise/core";var u,h=(u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},f=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,l=r.length;s<l;s++,o++)i[o]=r[s];return i},v=function(s){function l(){var e=null!==s&&s.apply(this,arguments)||this;return e.cellRanges=[],e.bodyScrollListener=e.onBodyScroll.bind(e),e.dragging=!1,e}return h(l,s),l.prototype.init=function(){var t=this;this.addManagedListener(this.eventService,e.EVENT_NEW_COLUMNS_LOADED,(function(){return t.removeAllCellRanges()})),this.addManagedListener(this.eventService,e.EVENT_COLUMN_PIVOT_MODE_CHANGED,(function(){return t.removeAllCellRanges()})),this.addManagedListener(this.eventService,e.EVENT_COLUMN_ROW_GROUP_CHANGED,(function(){return t.removeAllCellRanges()})),this.addManagedListener(this.eventService,e.EVENT_COLUMN_PIVOT_CHANGED,(function(){return t.removeAllCellRanges()})),this.addManagedListener(this.eventService,e.EVENT_COLUMN_GROUP_OPENED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,e.EVENT_COLUMN_MOVED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,e.EVENT_COLUMN_PINNED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,e.EVENT_COLUMN_VISIBLE,this.onColumnVisibleChange.bind(this)),this.ctrlsService.whenReady((function(){var e=t.ctrlsService.getGridBodyCtrl();t.autoScrollService=new w(e,t.gridOptionsWrapper)}))},l.prototype.onColumnVisibleChange=function(){var e=this;this.refreshLastRangeStart(),this.cellRanges.forEach((function(n){var i=n.columns;n.columns=n.columns.filter((function(e){return e.isVisible()})),!t.areEqual(i,n.columns)&&e.dispatchChangedEvent(!1,!0,n.id)}))},l.prototype.refreshLastRangeStart=function(){var e=t.last(this.cellRanges);e&&this.refreshRangeStart(e)},l.prototype.isContiguousRange=function(e){var n=e.columns;if(!n.length)return!1;var i=this.columnModel.getAllDisplayedColumns(),o=n.map((function(e){return i.indexOf(e)})).sort((function(e,t){return e-t}));return t.last(o)-o[0]+1===n.length},l.prototype.getRangeStartRow=function(e){return e.startRow&&e.endRow?this.rowPositionUtils.before(e.startRow,e.endRow)?e.startRow:e.endRow:{rowIndex:0,rowPinned:this.pinnedRowModel.getPinnedTopRowCount()>0?n.PINNED_TOP:null}},l.prototype.getRangeEndRow=function(e){if(e.startRow&&e.endRow)return this.rowPositionUtils.before(e.startRow,e.endRow)?e.endRow:e.startRow;var t=this.pinnedRowModel.getPinnedBottomRowCount();return t>0?{rowIndex:t-1,rowPinned:n.PINNED_BOTTOM}:{rowIndex:this.rowModel.getRowCount()-1,rowPinned:null}},l.prototype.setRangeToCell=function(e,n){if(void 0===n&&(n=!1),this.gridOptionsWrapper.isEnableRangeSelection()){var i=this.calculateColumnsBetween(e.column,e.column);if(i){(this.gridOptionsWrapper.isSuppressMultiRangeSelection()||!n||t.missing(this.cellRanges))&&this.removeAllCellRanges(!0);for(var o,r={rowIndex:e.rowIndex,rowPinned:e.rowPinned},s=0;s<this.cellRanges.length;s++){var l=this.cellRanges[s];if(l.columns&&1===l.columns.length&&l.columns[0]===e.column&&this.rowPositionUtils.sameRow(r,l.startRow)&&this.rowPositionUtils.sameRow(r,l.endRow)){o=l;break}}o?t.last(this.cellRanges)!==o&&(t.removeFromArray(this.cellRanges,o),this.cellRanges.push(o)):(o={startRow:r,endRow:r,columns:i,startColumn:e.column},this.cellRanges.push(o)),this.newestRangeStartCell=e,this.onDragStop(),this.dispatchChangedEvent(!0,!0,o.id)}}},l.prototype.extendLatestRangeToCell=function(e){if(!this.isEmpty()&&this.newestRangeStartCell){var n=t.last(this.cellRanges);this.updateRangeEnd(n,e)}},l.prototype.updateRangeEnd=function(e,t,n){void 0===n&&(n=!1);var i=t.column,o=this.calculateColumnsBetween(e.startColumn,i);o&&!this.isLastCellOfRange(e,t)&&(e.columns=o,e.endRow={rowIndex:t.rowIndex,rowPinned:t.rowPinned},n||this.dispatchChangedEvent(!0,!0,e.id))},l.prototype.refreshRangeStart=function(e){var n=e.startColumn,i=e.columns,o=function(t,n){var i=e.columns.filter((function(e){return e!==t}));t?(e.startColumn=t,e.columns=n?f([t],i):f(i,[t])):e.columns=i},r=this.getRangeEdgeColumns(e),s=r.left,l=r.right;n===i[0]&&n!==s?o(s,!0):n===t.last(i)&&n===l&&o(l,!1)},l.prototype.getRangeEdgeColumns=function(e){var n=this.columnModel.getAllDisplayedColumns(),i=e.columns.map((function(e){return n.indexOf(e)})).filter((function(e){return e>-1})).sort((function(e,t){return e-t}));return{left:n[i[0]],right:n[t.last(i)]}},l.prototype.extendLatestRangeInDirection=function(e){if(!this.isEmpty()&&this.newestRangeStartCell){var n=t.last(this.cellRanges),i=this.newestRangeStartCell,o=n.columns[0],r=t.last(n.columns),s=n.endRow.rowIndex,l=n.endRow.rowPinned,a={column:i.column===o?r:o,rowIndex:s,rowPinned:l},c=this.cellNavigationService.getNextCellToFocus(e,a);if(c)return this.setCellRange({rowStartIndex:i.rowIndex,rowStartPinned:i.rowPinned,rowEndIndex:c.rowIndex,rowEndPinned:c.rowPinned,columnStart:i.column,columnEnd:c.column}),c}},l.prototype.setCellRange=function(e){this.gridOptionsWrapper.isEnableRangeSelection()&&(this.removeAllCellRanges(!0),this.addCellRange(e))},l.prototype.setCellRanges=function(e){var n=this;t.shallowCompare(this.cellRanges,e)||(this.removeAllCellRanges(!0),e.forEach((function(e){e.columns&&e.startRow&&(n.newestRangeStartCell={rowIndex:e.startRow.rowIndex,rowPinned:e.startRow.rowPinned,column:e.columns[0]}),n.cellRanges.push(e)})),this.dispatchChangedEvent(!1,!0))},l.prototype.createCellRangeFromCellRangeParams=function(e){var t,n=this;if(e.columns)t=e.columns.map((function(e){return n.columnModel.getColumnWithValidation(e)})).filter((function(e){return e}));else{var i=this.columnModel.getColumnWithValidation(e.columnStart),o=this.columnModel.getColumnWithValidation(e.columnEnd);if(!i||!o)return;t=this.calculateColumnsBetween(i,o)}if(t)return{startRow:null!=e.rowStartIndex?{rowIndex:e.rowStartIndex,rowPinned:e.rowStartPinned||null}:void 0,endRow:null!=e.rowEndIndex?{rowIndex:e.rowEndIndex,rowPinned:e.rowEndPinned||null}:void 0,columns:t,startColumn:t[0]}},l.prototype.addCellRange=function(e){if(this.gridOptionsWrapper.isEnableRangeSelection()){var t=this.createCellRangeFromCellRangeParams(e);t&&(this.cellRanges.push(t),this.dispatchChangedEvent(!1,!0,t.id))}},l.prototype.getCellRanges=function(){return this.cellRanges},l.prototype.isEmpty=function(){return 0===this.cellRanges.length},l.prototype.isMoreThanOneCell=function(){if(0===this.cellRanges.length)return!1;if(this.cellRanges.length>1)return!0;var e=this.cellRanges[0],t=this.getRangeStartRow(e),n=this.getRangeEndRow(e);return t.rowPinned!==n.rowPinned||t.rowIndex!==n.rowIndex||1!==e.columns.length},l.prototype.removeAllCellRanges=function(e){this.isEmpty()||(this.onDragStop(),this.cellRanges.length=0,e||this.dispatchChangedEvent(!1,!0))},l.prototype.onBodyScroll=function(){this.onDragging(this.lastMouseEvent)},l.prototype.isCellInAnyRange=function(e){return this.getCellRangeCount(e)>0},l.prototype.isCellInSpecificRange=function(e,n){var i=null!==n.columns&&t.includes(n.columns,e.column),o=this.isRowInRange(e.rowIndex,e.rowPinned,n);return i&&o},l.prototype.isLastCellOfRange=function(e,n){var i=e.startRow,o=e.endRow,r=this.rowPositionUtils.before(i,o)?o:i,s=n.rowIndex===r.rowIndex&&n.rowPinned===r.rowPinned,l=e.columns[0],a=t.last(e.columns),c=e.startColumn===l?a:l;return n.column===c&&s},l.prototype.isBottomRightCell=function(e,n){var i=this.columnModel.getAllDisplayedColumns(),o=e.columns.map((function(e){return i.indexOf(e)})).sort((function(e,t){return e-t})),r=e.startRow,s=e.endRow,l=this.rowPositionUtils.before(r,s)?s:r,a=i.indexOf(n.column)===t.last(o),c=n.rowIndex===l.rowIndex&&t.makeNull(n.rowPinned)===t.makeNull(l.rowPinned);return a&&c},l.prototype.getCellRangeCount=function(e){var t=this;return this.isEmpty()?0:this.cellRanges.filter((function(n){return t.isCellInSpecificRange(e,n)})).length},l.prototype.isRowInRange=function(e,t,n){var i=this.getRangeStartRow(n),o=this.getRangeEndRow(n),r={rowIndex:e,rowPinned:t||null},s=r.rowIndex===i.rowIndex&&r.rowPinned==i.rowPinned,l=r.rowIndex===o.rowIndex&&r.rowPinned==o.rowPinned;if(s||l)return!0;var a=!this.rowPositionUtils.before(r,i),c=this.rowPositionUtils.before(r,o);return a&&c},l.prototype.getDraggingRange=function(){return this.draggingRange},l.prototype.onDragStart=function(e){if(this.gridOptionsWrapper.isEnableRangeSelection()){var n=e.ctrlKey,i=e.metaKey,o=e.shiftKey,r=n||i,s=!!!this.gridOptionsWrapper.isSuppressMultiRangeSelection()&&r,l=this.mouseEventService.getCellPositionForEvent(e),a=o&&t.existsAndNotEmpty(this.cellRanges);if(!t.missing(l)){if(s||a&&!t.exists(t.last(this.cellRanges).type)||this.removeAllCellRanges(!0),this.dragging=!0,this.draggingCell=l,this.lastMouseEvent=e,a||(this.newestRangeStartCell=l),this.cellRanges.length>0)this.draggingRange=t.last(this.cellRanges);else{var c={rowIndex:l.rowIndex,rowPinned:l.rowPinned};this.draggingRange={startRow:c,endRow:c,columns:[l.column],startColumn:this.newestRangeStartCell.column},this.cellRanges.push(this.draggingRange)}this.ctrlsService.getGridBodyCtrl().addScrollEventListener(this.bodyScrollListener),this.dispatchChangedEvent(!0,!1,this.draggingRange.id)}}},l.prototype.onDragging=function(e){var t=this;if(this.dragging&&e){this.lastMouseEvent=e;var n=this.mouseEventService.getCellPositionForEvent(e),i=function(e){return n&&n.rowPinned===e&&t.newestRangeStartCell.rowPinned===e},o=i("top")||i("bottom");if(this.autoScrollService.check(e,o),n&&this.draggingCell&&!this.cellPositionUtils.equals(this.draggingCell,n)){var r=this.calculateColumnsBetween(this.newestRangeStartCell.column,n.column);r&&(this.draggingCell=n,this.draggingRange.endRow={rowIndex:n.rowIndex,rowPinned:n.rowPinned},this.draggingRange.columns=r,this.dispatchChangedEvent(!1,!1,this.draggingRange.id))}}},l.prototype.onDragStop=function(){if(this.dragging){var e=this.draggingRange.id;this.autoScrollService.ensureCleared(),this.ctrlsService.getGridBodyCtrl().removeScrollEventListener(this.bodyScrollListener),this.lastMouseEvent=null,this.dragging=!1,this.draggingRange=void 0,this.draggingCell=void 0,this.dispatchChangedEvent(!1,!0,e)}},l.prototype.dispatchChangedEvent=function(t,n,i){var o=Object.freeze({type:e.EVENT_RANGE_SELECTION_CHANGED,api:this.gridApi,columnApi:this.columnApi,started:t,finished:n,id:i});this.eventService.dispatchEvent(o)},l.prototype.calculateColumnsBetween=function(e,t){var n=this.columnModel.getAllDisplayedColumns(),i=e===t,o=n.indexOf(e);if(o<0)console.warn("AG Grid: column "+e.getId()+" is not visible");else{var r=i?o:n.indexOf(t);if(!(r<0)){if(i)return[e];for(var s=Math.min(o,r),l=s===o?r:o,a=[],c=s;c<=l;c++)a.push(n[c]);return a}console.warn("AG Grid: column "+t.getId()+" is not visible")}},p([i("loggerFactory")],l.prototype,"loggerFactory",void 0),p([i("rowModel")],l.prototype,"rowModel",void 0),p([i("columnModel")],l.prototype,"columnModel",void 0),p([i("mouseEventService")],l.prototype,"mouseEventService",void 0),p([i("columnApi")],l.prototype,"columnApi",void 0),p([i("gridApi")],l.prototype,"gridApi",void 0),p([i("cellNavigationService")],l.prototype,"cellNavigationService",void 0),p([i("pinnedRowModel")],l.prototype,"pinnedRowModel",void 0),p([i("rowPositionUtils")],l.prototype,"rowPositionUtils",void 0),p([i("cellPositionUtils")],l.prototype,"cellPositionUtils",void 0),p([i("ctrlsService")],l.prototype,"ctrlsService",void 0),p([o],l.prototype,"init",null),l=p([r("rangeService")],l)}(s),w=function(){function e(e,t){this.tickingInterval=null,this.gridBodyCtrl=e,this.gridOptionsWrapper=t}return e.prototype.check=function(e,t){void 0===t&&(t=!1);var i=this.gridBodyCtrl.getBodyClientRect();(t=t||this.gridOptionsWrapper.getDomLayout()!==n.DOM_LAYOUT_NORMAL)&&!this.gridBodyCtrl.getScrollFeature().isHorizontalScrollShowing()||(this.tickLeft=e.clientX<i.left+20,this.tickRight=e.clientX>i.right-20,this.tickUp=e.clientY<i.top+20&&!t,this.tickDown=e.clientY>i.bottom-20&&!t,this.tickLeft||this.tickRight||this.tickUp||this.tickDown?this.ensureTickingStarted():this.ensureCleared())},e.prototype.ensureTickingStarted=function(){null===this.tickingInterval&&(this.tickingInterval=window.setInterval(this.doTick.bind(this),100),this.tickCount=0)},e.prototype.doTick=function(){this.tickCount++;var e,t=this.gridBodyCtrl.getScrollFeature().getVScrollPosition(),n=this.gridBodyCtrl.getScrollFeature().getHScrollPosition();e=this.tickCount>20?200:this.tickCount>10?80:40,this.tickUp&&this.gridBodyCtrl.getScrollFeature().setVerticalScrollPosition(t.top-e),this.tickDown&&this.gridBodyCtrl.getScrollFeature().setVerticalScrollPosition(t.top+e),this.tickLeft&&this.gridBodyCtrl.getScrollFeature().setHorizontalScrollPosition(n.left-e),this.tickRight&&this.gridBodyCtrl.getScrollFeature().setHorizontalScrollPosition(n.left+e)},e.prototype.ensureCleared=function(){this.tickingInterval&&(window.clearInterval(this.tickingInterval),this.tickingInterval=null)},e}(),R=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},C=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.changedCalculatedValues=!1,t.dragging=!1,t.shouldDestroyOnEndDragging=!1,t}return R(n,e),n.prototype.init=function(){var e=this;this.dragService.addDragSource({dragStartPixels:0,eElement:this.getGui(),onDragStart:this.onDragStart.bind(this),onDragging:function(t){e.dragging=!0,e.rangeService.autoScrollService.check(t),e.changedCalculatedValues&&(e.onDrag(t),e.changedCalculatedValues=!1)},onDragStop:function(n){e.dragging=!1,e.onDragEnd(n),e.clearValues(),e.rangeService.autoScrollService.ensureCleared(),t.removeCssClass(document.body,e.getDraggingCssClass()),e.shouldDestroyOnEndDragging&&e.destroy()}}),this.addManagedListener(this.getGui(),"mousedown",this.preventRangeExtension.bind(this))},n.prototype.isDragging=function(){return this.dragging},n.prototype.getCellCtrl=function(){return this.cellCtrl},n.prototype.setCellCtrl=function(e){this.cellCtrl=e},n.prototype.getCellRange=function(){return this.cellRange},n.prototype.setCellRange=function(e){this.cellRange=e},n.prototype.getRangeStartRow=function(){return this.rangeStartRow},n.prototype.setRangeStartRow=function(e){this.rangeStartRow=e},n.prototype.getRangeEndRow=function(){return this.rangeEndRow},n.prototype.setRangeEndRow=function(e){this.rangeEndRow=e},n.prototype.getLastCellHovered=function(){return this.lastCellHovered},n.prototype.preventRangeExtension=function(e){e.preventDefault(),e.stopPropagation()},n.prototype.onDragStart=function(e){this.cellHoverListener=this.addManagedListener(this.ctrlsService.getGridCtrl().getGui(),"mousemove",this.updateValuesOnMove.bind(this)),t.addCssClass(document.body,this.getDraggingCssClass())},n.prototype.getDraggingCssClass=function(){return"ag-dragging-"+(this.type===l.FILL?"fill":"range")+"-handle"},n.prototype.updateValuesOnMove=function(e){var t=this.mouseEventService.getCellPositionForEvent(e);t!==this.lastCellHovered&&(this.lastCellHovered=t,this.changedCalculatedValues=!0)},n.prototype.getType=function(){return this.type},n.prototype.refresh=function(e){var n=this,i=this.getCellCtrl(),o=this.getGui(),r=t.last(this.rangeService.getCellRanges()),s=r.startRow,l=r.endRow;s&&l&&(this.rowPositionUtils.before(l,s)?(this.setRangeStartRow(l),this.setRangeEndRow(s)):(this.setRangeStartRow(s),this.setRangeEndRow(l)));i===e&&t.isVisible(o)||(this.setCellCtrl(e),window.setTimeout((function(){n.isAlive()&&e.appendChild(o)}),1)),this.setCellRange(r)},n.prototype.clearValues=function(){this.lastCellHovered=void 0,this.removeListeners()},n.prototype.removeListeners=function(){this.cellHoverListener&&(this.cellHoverListener(),this.cellHoverListener=void 0)},n.prototype.destroy=function(){if(!this.shouldDestroyOnEndDragging&&this.isDragging())return t.setDisplayed(this.getGui(),!1),void(this.shouldDestroyOnEndDragging=!0);this.shouldDestroyOnEndDragging=!1,e.prototype.destroy.call(this),this.removeListeners();var n=this.getGui();n.parentElement&&n.parentElement.removeChild(n)},m([i("rowRenderer")],n.prototype,"rowRenderer",void 0),m([i("dragService")],n.prototype,"dragService",void 0),m([i("rangeService")],n.prototype,"rangeService",void 0),m([i("mouseEventService")],n.prototype,"mouseEventService",void 0),m([i("columnModel")],n.prototype,"columnModel",void 0),m([i("cellNavigationService")],n.prototype,"cellNavigationService",void 0),m([i("navigationService")],n.prototype,"navigationService",void 0),m([i("rowPositionUtils")],n.prototype,"rowPositionUtils",void 0),m([i("ctrlsService")],n.prototype,"ctrlsService",void 0),m([o],n.prototype,"init",null),n}(a),y=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),S=function(){return(S=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},P=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},E=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,l=r.length;s<l;s++,o++)i[o]=r[s];return i},O=function(n){function o(){var e=n.call(this,o.TEMPLATE)||this;return e.markedCells=[],e.cellValues=[],e.isUp=!1,e.isLeft=!1,e.isReduce=!1,e.type=l.FILL,e}return y(o,n),o.prototype.updateValuesOnMove=function(e){n.prototype.updateValuesOnMove.call(this,e),this.initialXY||(this.initialXY=this.mouseEventService.getNormalisedPosition(e));var t,i=this.initialXY,o=i.x,r=i.y,s=this.mouseEventService.getNormalisedPosition(e),l=s.x,a=s.y,c=Math.abs(o-l),g=Math.abs(r-a),d=this.gridOptionsWrapper.getFillHandleDirection();(t="xy"===d?c>g?"x":"y":d)!==this.dragAxis&&(this.dragAxis=t,this.changedCalculatedValues=!0)},o.prototype.onDrag=function(e){if(!this.initialPosition){var t=this.getCellCtrl();if(!t)return;this.initialPosition=t.getCellPosition()}var n=this.getLastCellHovered();n&&this.markPathFrom(this.initialPosition,n)},o.prototype.onDragEnd=function(e){if(this.initialXY=null,this.markedCells.length){var t,n="x"===this.dragAxis,i=this.getCellRange(),o=i.columns.length,r=this.getRangeStartRow(),s=this.getRangeEndRow();if(this.isUp||this.isLeft){var l=n?r:this.lastCellMarked;t=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:l.rowIndex,rowStartPinned:l.rowPinned,columnStart:n?this.lastCellMarked.column:i.columns[0],rowEndIndex:s.rowIndex,rowEndPinned:s.rowPinned,columnEnd:i.columns[o-1]})}else t=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:r.rowIndex,rowStartPinned:r.rowPinned,columnStart:i.columns[0],rowEndIndex:n?s.rowIndex:this.lastCellMarked.rowIndex,rowEndPinned:n?s.rowPinned:this.lastCellMarked.rowPinned,columnEnd:n?this.lastCellMarked.column:i.columns[o-1]});t&&(this.raiseFillStartEvent(),this.handleValueChanged(i,t,e),this.rangeService.setCellRanges([t]),this.raiseFillEndEvent(i,t))}},o.prototype.raiseFillStartEvent=function(){var t={type:e.EVENT_FILL_START,columnApi:this.gridOptionsWrapper.getColumnApi(),api:this.gridOptionsWrapper.getApi()};this.eventService.dispatchEvent(t)},o.prototype.raiseFillEndEvent=function(t,n){var i={type:e.EVENT_FILL_END,columnApi:this.gridOptionsWrapper.getColumnApi(),api:this.gridOptionsWrapper.getApi(),initialRange:t,finalRange:n};this.eventService.dispatchEvent(i)},o.prototype.handleValueChanged=function(e,n,i){var o=this,r=this.rangeService.getRangeEndRow(e),s=this.rangeService.getRangeStartRow(e),l=this.rangeService.getRangeEndRow(n),a=this.rangeService.getRangeStartRow(n),c="y"===this.dragAxis;if(!this.isReduce||this.gridOptionsWrapper.isSuppressClearOnFillReduction()){var g=!0,d=[],u=[],h=0,p=function(){d.length=0,u.length=0,h=0},f=function(n,i){var u=o.isUp?r:s,h=!1;c&&(g=!0,p());for(var f=function(){var f=o.rowPositionUtils.getRowNode(u);if(!f)return"break";c&&n?v(d,n,f,(function(){return!o.rowPositionUtils.sameRow(u,o.isUp?s:r)})):i&&(g=!0,p(),i.forEach((function(n){return v(d,n,f,(function(){return n!==(o.isLeft?e.columns[0]:t.last(e.columns))}))}))),h=o.rowPositionUtils.sameRow(u,o.isUp?a:l),u=o.isUp?o.cellNavigationService.getRowAbove(u):o.cellNavigationService.getRowBelow(u)};!h&&u;){if("break"===f())break}},v=function(e,t,n,r){var s;g?(s=o.valueService.getValue(t,n),u.push(s),g=r()):(s=o.processValues(i,e,u,t,n,h++),t.isCellEditable(n)&&n.setDataValue(t,s)),e.push(s)};if(c)e.columns.forEach((function(e){f(e)}));else{w=this.isLeft?E(n.columns).reverse():n.columns;f(void 0,w)}}else{var w=c?e.columns:e.columns.filter((function(e){return n.columns.indexOf(e)<0})),R=c?this.cellNavigationService.getRowBelow(l):a;R&&this.clearCellsInRange(R,r,w)}},o.prototype.clearCellsInRange=function(e,t,n){for(var i=this,o=e,r=!1,s=function(){var e=l.rowPositionUtils.getRowNode(o);if(!e)return"break";n.forEach((function(t){t.isCellEditable(e)&&i.valueService.setValue(e,t,null)})),r=l.rowPositionUtils.sameRow(o,t),o=l.cellNavigationService.getRowBelow(o)},l=this;!r&&o;){if("break"===s())break}},o.prototype.processValues=function(e,n,i,o,r,s){var l,a=this.gridOptionsWrapper.getFillOperation(),c="y"===this.dragAxis;if(l=c?this.isUp?"up":"down":this.isLeft?"left":"right",a){var g=a({event:e,values:n,initialValues:i,currentIndex:s,currentCellValue:this.valueService.getValue(o,r),api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi(),context:this.gridOptionsWrapper.getContext(),direction:l,column:c?o:void 0,rowNode:c?void 0:r});if(!1!==g)return g}var d=!n.some((function(e){var t=parseFloat(e);return isNaN(t)||t.toString()!==e.toString()}));if(e.altKey||!d){if(d&&1===i.length){var u=this.isUp||this.isLeft?-1:1;return parseFloat(t.last(n))+1*u}return n[s%n.length]}return t.last(t.findLineByLeastSquares(n.map(Number)))},o.prototype.clearValues=function(){this.clearMarkedPath(),this.clearCellValues(),this.lastCellMarked=void 0,n.prototype.clearValues.call(this)},o.prototype.clearMarkedPath=function(){this.markedCells.forEach((function(e){var t=e.getComp();t.addOrRemoveCssClass("ag-selection-fill-top",!1),t.addOrRemoveCssClass("ag-selection-fill-right",!1),t.addOrRemoveCssClass("ag-selection-fill-bottom",!1),t.addOrRemoveCssClass("ag-selection-fill-left",!1)})),this.markedCells.length=0,this.isUp=!1,this.isLeft=!1,this.isReduce=!1},o.prototype.clearCellValues=function(){this.cellValues.length=0},o.prototype.markPathFrom=function(e,t){if(this.clearMarkedPath(),this.clearCellValues(),"y"===this.dragAxis){if(this.rowPositionUtils.sameRow(t,e))return;var n=this.rowPositionUtils.before(t,e),i=this.getRangeStartRow(),o=this.getRangeEndRow();n&&(t.rowPinned==i.rowPinned&&t.rowIndex>=i.rowIndex||i.rowPinned!=o.rowPinned&&t.rowPinned==o.rowPinned&&t.rowIndex<=o.rowIndex)?(this.reduceVertical(e,t),this.isReduce=!0):(this.extendVertical(e,t,n),this.isReduce=!1)}else{var r=e.column,s=t.column;if(r===s)return;var l=this.columnModel.getAllDisplayedColumns(),a=l.indexOf(r),c=l.indexOf(s);c<=a&&c>=l.indexOf(this.getCellRange().columns[0])?(this.reduceHorizontal(e,t),this.isReduce=!0):(this.extendHorizontal(e,t,c<a),this.isReduce=!1)}this.lastCellMarked=t},o.prototype.extendVertical=function(e,t,n){var i=this.navigationService,o=this.rangeService,r=e;do{for(var s=this.getCellRange(),l=s.columns.length,a=0;a<l;a++){var c=s.columns[a],g={rowIndex:r.rowIndex,rowPinned:r.rowPinned},d=S(S({},g),{column:c}),u=o.isCellInSpecificRange(d,s),h=this.rowPositionUtils.sameRow(r,e);if(n&&(this.isUp=!0),!h){var p=i.getCellByPosition(d);if(p){this.markedCells.push(p);var f=p.getComp();u||(f.addOrRemoveCssClass("ag-selection-fill-left",0===a),f.addOrRemoveCssClass("ag-selection-fill-right",a===l-1)),f.addOrRemoveCssClass(n?"ag-selection-fill-top":"ag-selection-fill-bottom",this.rowPositionUtils.sameRow(r,t))}}}if(this.rowPositionUtils.sameRow(r,t))break}while(r=n?this.cellNavigationService.getRowAbove(r):this.cellNavigationService.getRowBelow(r))},o.prototype.reduceVertical=function(e,t){var n=e;do{for(var i=this.getCellRange(),o=i.columns.length,r=this.rowPositionUtils.sameRow(n,t),s=0;s<o;s++){var l={rowIndex:n.rowIndex,rowPinned:n.rowPinned},a=S(S({},l),{column:i.columns[s]}),c=this.navigationService.getCellByPosition(a);if(c)this.markedCells.push(c),c.getComp().addOrRemoveCssClass("ag-selection-fill-bottom",this.rowPositionUtils.sameRow(n,t))}if(r)break}while(n=this.cellNavigationService.getRowAbove(n))},o.prototype.extendHorizontal=function(e,n,i){var o=this,r=this.columnModel.getAllDisplayedColumns(),s=r.indexOf(i?n.column:e.column),l=r.indexOf(i?this.getCellRange().columns[0]:n.column),a=i?0:1,c=r.slice(s+a,l+a),g=this.getRangeStartRow(),d=this.getRangeEndRow();c.forEach((function(e){var n=g,r=!1;do{r=o.rowPositionUtils.sameRow(n,d);var s=o.navigationService.getCellByPosition({rowIndex:n.rowIndex,rowPinned:n.rowPinned,column:e});if(s){o.markedCells.push(s);var l=s.getComp();l.addOrRemoveCssClass("ag-selection-fill-top",o.rowPositionUtils.sameRow(n,g)),l.addOrRemoveCssClass("ag-selection-fill-bottom",o.rowPositionUtils.sameRow(n,d)),i?(o.isLeft=!0,l.addOrRemoveCssClass("ag-selection-fill-left",e===c[0])):l.addOrRemoveCssClass("ag-selection-fill-right",e===t.last(c))}n=o.cellNavigationService.getRowBelow(n)}while(!r)}))},o.prototype.reduceHorizontal=function(e,t){var n=this,i=this.columnModel.getAllDisplayedColumns(),o=i.indexOf(t.column),r=i.indexOf(e.column),s=i.slice(o,r),l=this.getRangeStartRow(),a=this.getRangeEndRow();s.forEach((function(e){var t=l,i=!1;do{i=n.rowPositionUtils.sameRow(t,a);var o=n.navigationService.getCellByPosition({rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:e});if(o)n.markedCells.push(o),o.getComp().addOrRemoveCssClass("ag-selection-fill-right",e===s[0]);t=n.cellNavigationService.getRowBelow(t)}while(!i)}))},o.prototype.refresh=function(e){var t=this.rangeService.getCellRanges()[0];t.startRow&&t.endRow?n.prototype.refresh.call(this,e):this.destroy()},o.TEMPLATE='<div class="ag-fill-handle"></div>',P([i("valueService")],o.prototype,"valueService",void 0),o}(C),x=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),I=function(){return(I=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},b=function(e){function n(){var t=e.call(this,n.TEMPLATE)||this;return t.type=l.RANGE,t.rangeFixed=!1,t}return x(n,e),n.prototype.onDrag=function(e){var n=this.getLastCellHovered();if(n){var i=this.rangeService.getCellRanges(),o=t.last(i);if(this.rangeFixed||(this.fixRangeStartEnd(o),this.rangeFixed=!0),this.endPosition={rowIndex:n.rowIndex,rowPinned:n.rowPinned,column:n.column},2===i.length&&i[0].type===c.DIMENSION&&o.type===c.VALUE)!this.rowPositionUtils.sameRow(this.endPosition,this.rangeService.getRangeEndRow(o))&&this.rangeService.updateRangeEnd(i[0],I(I({},this.endPosition),{column:i[0].columns[0]}),!0);this.rangeService.extendLatestRangeToCell(this.endPosition)}},n.prototype.onDragEnd=function(e){var n=t.last(this.rangeService.getCellRanges());this.fixRangeStartEnd(n),this.rangeFixed=!1},n.prototype.fixRangeStartEnd=function(e){var t=this.rangeService.getRangeStartRow(e),n=this.rangeService.getRangeEndRow(e),i=e.columns[0];e.startRow=t,e.endRow=n,e.startColumn=i},n.TEMPLATE='<div class="ag-range-handle"></div>',n}(C),L=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),M=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return L(t,e),t.prototype.createSelectionHandle=function(e){return this.createBean(e===l.RANGE?new b:new O)},t=M([r("selectionHandleFactory")],t)}(s),A={moduleName:g.RangeSelectionModule,beans:[v,_],agStackComponents:[{componentName:"AgFillHandle",componentClass:O},{componentName:"AgRangeHandle",componentClass:b}],dependantModules:[d]};export{A as RangeSelectionModule};