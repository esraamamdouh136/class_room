/**
 * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
import{_ as e,Autowired as t,Component as i,VirtualList as r,KeyCode as s,RefSelector as n,PopupComponent as o,ModuleNames as a}from"@ag-grid-community/core";import{EnterpriseCoreModule as l}from"@ag-grid-enterprise/core";var c,u=(c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),h=function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},p=function(i){function r(e){var t=i.call(this,'<div class="ag-rich-select-row"></div>')||this;return t.params=e,t}return u(r,i),r.prototype.setState=function(t,i,r){this.populateWithRenderer(t,i)||this.populateWithoutRenderer(t,i),e.addOrRemoveCssClass(this.getGui(),"ag-rich-select-row-selected",r)},r.prototype.populateWithoutRenderer=function(t,i){var r=null!=i?i:t;e.exists(r)&&""!==r?this.getGui().textContent=r.toString():this.getGui().innerHTML="&nbsp;"},r.prototype.populateWithRenderer=function(t,i){var r=this,s={value:t,valueFormatted:i,api:this.gridOptionsWrapper.getApi()},n=this.userComponentFactory.newCellRenderer(this.params,s);return null!=n?e.bindCellRendererToHtmlElement(n,this.getGui()):this.getGui().innerText=null!=s.valueFormatted?s.valueFormatted:s.value,!!n&&(n.then((function(e){r.addDestroyFunc((function(){r.getContext().destroyBean(e)}))})),!0)},h([t("userComponentFactory")],r.prototype,"userComponentFactory",void 0),r}(i),d=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),f=function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},v=function(i){function o(){var e=i.call(this,o.TEMPLATE)||this;return e.selectionConfirmed=!1,e.searchString="",e}return d(o,i),o.prototype.init=function(t){this.params=t,this.selectedValue=t.value,this.originalSelectedValue=t.value,this.focusAfterAttached=t.cellStartedEdit;var i=e.createIconNoSpan("smallDown",this.gridOptionsWrapper);if(e.addCssClass(i,"ag-rich-select-value-icon"),this.eValue.appendChild(i),this.virtualList=this.getContext().createBean(new r("rich-select")),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),e.exists(this.params.cellHeight)&&this.virtualList.setRowHeight(this.params.cellHeight),this.renderSelectedValue(),e.missing(t.values))console.warn("AG Grid: richSelectCellEditor requires values for it to work");else{var s=t.values;this.virtualList.setModel({getRowCount:function(){return s.length},getRow:function(e){return s[e]}}),this.addGuiEventListener("keydown",this.onKeyDown.bind(this));var n=this.virtualList.getGui();this.addManagedListener(n,"click",this.onClick.bind(this)),this.addManagedListener(n,"mousemove",this.onMouseMove.bind(this));var o=e.exists(t.searchDebounceDelay)?t.searchDebounceDelay:300;this.clearSearchString=e.debounce(this.clearSearchString,o),e.exists(t.charPress)&&this.searchText(t.charPress)}},o.prototype.onKeyDown=function(e){var t=e.keyCode;switch(e.preventDefault(),t){case s.ENTER:this.onEnterKeyDown();break;case s.DOWN:case s.UP:this.onNavigationKeyPressed(e,t);break;default:this.searchText(e)}},o.prototype.onEnterKeyDown=function(){this.selectionConfirmed=!0,this.params.stopEditing()},o.prototype.onNavigationKeyPressed=function(e,t){e.preventDefault();var i=this.params.values.indexOf(this.selectedValue),r=t===s.UP?i-1:i+1;if(r>=0&&r<this.params.values.length){var n=this.params.values[r];this.setSelectedValue(n)}},o.prototype.searchText=function(t){if("string"==typeof t)this.searchString+=t,this.runSearch(),this.clearSearchString();else{var i=t.keyCode,r=t.key;if(i===s.BACKSPACE)this.searchString=this.searchString.slice(0,-1),r="";else if(!e.isEventFromPrintableCharacter(t))return;this.searchText(r)}},o.prototype.runSearch=function(){var t,i=this.params.values;if("number"!=typeof i[0]&&"string"!=typeof i[0]||(t=i.map(String)),"object"==typeof i[0]&&this.params.colDef.keyCreator&&(t=i.map(this.params.colDef.keyCreator)),t){var r=e.fuzzySuggestions(this.searchString,t,!0,!0)[0];if(r){var s=i[t.indexOf(r)];this.setSelectedValue(s)}}},o.prototype.clearSearchString=function(){this.searchString=""},o.prototype.renderSelectedValue=function(){var t=this,i=this.params.formatValue(this.selectedValue),r=this.eValue,s={value:this.selectedValue,valueFormatted:i,api:this.gridOptionsWrapper.getApi()},n=this.userComponentFactory.newCellRenderer(this.params,s);e.exists(n)?(e.bindCellRendererToHtmlElement(n,r),n.then((function(e){t.addDestroyFunc((function(){return t.getContext().destroyBean(e)}))}))):e.exists(this.selectedValue)?r.innerHTML=i:e.clearElement(r)},o.prototype.setSelectedValue=function(e){if(this.selectedValue!==e){var t=this.params.values.indexOf(e);-1!==t&&(this.selectedValue=e,this.virtualList.ensureIndexVisible(t),this.virtualList.refresh())}},o.prototype.createRowComponent=function(e){var t=this.params.formatValue(e),i=new p(this.params);return this.getContext().createBean(i),i.setState(e,t,e===this.selectedValue),i},o.prototype.onMouseMove=function(e){var t=this.virtualList.getGui().getBoundingClientRect(),i=this.virtualList.getScrollTop(),r=e.clientY-t.top+i,s=Math.floor(r/this.virtualList.getRowHeight()),n=this.params.values[s];void 0!==n&&this.setSelectedValue(n)},o.prototype.onClick=function(){this.selectionConfirmed=!0,this.params.stopEditing()},o.prototype.afterGuiAttached=function(){var e=this.params.values.indexOf(this.selectedValue);this.virtualList.refresh(),e>=0&&this.virtualList.ensureIndexVisible(e),this.virtualList.refresh(),this.focusAfterAttached&&this.getGui().focus()},o.prototype.getValue=function(){return this.selectionConfirmed?this.selectedValue:this.originalSelectedValue},o.TEMPLATE='<div class="ag-rich-select" tabindex="-1">\n            <div ref="eValue" class="ag-rich-select-value"></div>\n            <div ref="eList" class="ag-rich-select-list"></div>\n        </div>',f([t("userComponentFactory")],o.prototype,"userComponentFactory",void 0),f([n("eValue")],o.prototype,"eValue",void 0),f([n("eList")],o.prototype,"eList",void 0),o}(o),g={moduleName:a.RichSelectModule,beans:[],userComponents:[{componentName:"agRichSelect",componentClass:v},{componentName:"agRichSelectCellEditor",componentClass:v}],dependantModules:[l]};export{g as RichSelectModule};