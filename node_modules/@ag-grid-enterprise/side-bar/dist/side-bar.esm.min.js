/**
 * @ag-grid-enterprise/side-bar - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/side-bar - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
import{Autowired as t,PostConstruct as e,Component as o,KeyCode as n,_ as r,PreDestroy as i,RefSelector as s,ModuleRegistry as a,ModuleNames as l,Events as p,Bean as u,BeanStub as c,OriginalColumnGroup as d}from"@ag-grid-community/core";import{EnterpriseCoreModule as f}from"@ag-grid-enterprise/core";var h,y=(h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),g=function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,o,s):r(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},v=function(o){function n(){var t=o.call(this,'<div class="ag-tool-panel-horizontal-resize"></div>')||this;return t.minWidth=100,t.maxWidth=null,t}return y(n,o),n.prototype.setElementToResize=function(t){this.elementToResize=t},n.prototype.postConstruct=function(){var t=this.horizontalResizeService.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizing.bind(this)});this.addDestroyFunc(t),this.setInverted(this.gridOptionsWrapper.isEnableRtl())},n.prototype.onResizeStart=function(){this.startingWidth=this.elementToResize.offsetWidth},n.prototype.onResizing=function(t){var e=this.inverted?-1:1,o=Math.max(this.minWidth,Math.floor(this.startingWidth-t*e));null!=this.maxWidth&&(o=Math.min(this.maxWidth,o)),this.elementToResize.style.width=o+"px"},n.prototype.setInverted=function(t){this.inverted=t},n.prototype.setMaxWidth=function(t){this.maxWidth=t},n.prototype.setMinWidth=function(t){this.minWidth=null!=t?t:100},g([t("horizontalResizeService")],n.prototype,"horizontalResizeService",void 0),g([e],n.prototype,"postConstruct",null),n}(o),P=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),m=function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,o,s):r(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},T=function(o){function s(){var t=o.call(this,s.TEMPLATE)||this;return t.buttonComps=[],t}return P(s,o),s.prototype.postConstruct=function(){this.addManagedListener(this.getFocusableElement(),"keydown",this.handleKeyDown.bind(this))},s.prototype.handleKeyDown=function(t){if(t.keyCode===n.TAB&&t.shiftKey&&!this.focusService.findNextFocusableElement(this.getFocusableElement(),null,!0)){var e=this.headerPositionUtils.findColAtEdgeForHeaderRow(0,"start");if(!e)return;t.preventDefault(),this.focusService.focusHeaderPosition(e)}},s.prototype.setToolPanelDefs=function(t){t.forEach(this.addButtonComp.bind(this))},s.prototype.setActiveButton=function(t){this.buttonComps.forEach((function(e){e.setSelected(t===e.getToolPanelId())}))},s.prototype.addButtonComp=function(t){var e=this,o=this.createBean(new C(t));this.buttonComps.push(o),this.appendChild(o),o.addEventListener(C.EVENT_TOGGLE_BUTTON_CLICKED,(function(){e.dispatchEvent({type:s.EVENT_SIDE_BAR_BUTTON_CLICKED,toolPanelId:t.id})}))},s.prototype.clearButtons=function(){this.buttonComps=this.destroyBeans(this.buttonComps),r.clearElement(this.getGui())},s.EVENT_SIDE_BAR_BUTTON_CLICKED="sideBarButtonClicked",s.TEMPLATE='<div class="ag-side-buttons"></div>',m([t("focusService")],s.prototype,"focusService",void 0),m([t("headerPositionUtils")],s.prototype,"headerPositionUtils",void 0),m([e],s.prototype,"postConstruct",null),m([i],s.prototype,"clearButtons",null),s}(o),C=function(t){function o(e){var o=t.call(this)||this;return o.toolPanelDef=e,o}return P(o,t),o.prototype.getToolPanelId=function(){return this.toolPanelDef.id},o.prototype.postConstruct=function(){var t=this.createTemplate();this.setTemplate(t),this.eIconWrapper.insertAdjacentElement("afterbegin",r.createIconNoSpan(this.toolPanelDef.iconKey,this.gridOptionsWrapper)),this.addManagedListener(this.eToggleButton,"click",this.onButtonPressed.bind(this))},o.prototype.createTemplate=function(){var t=this.gridOptionsWrapper.getLocaleTextFunc(),e=this.toolPanelDef;return'<div class="ag-side-button">\n                <button type="button" ref="eToggleButton" class="ag-side-button-button">\n                    <div ref="eIconWrapper" class="ag-side-button-icon-wrapper"></div>\n                    <span class="ag-side-button-label">'+t(e.labelKey,e.labelDefault)+"</span>\n                </button>\n            </div>"},o.prototype.onButtonPressed=function(){this.dispatchEvent({type:o.EVENT_TOGGLE_BUTTON_CLICKED})},o.prototype.setSelected=function(t){this.addOrRemoveCssClass("ag-selected",t)},o.EVENT_TOGGLE_BUTTON_CLICKED="toggleButtonClicked",m([s("eToggleButton")],o.prototype,"eToggleButton",void 0),m([s("eIconWrapper")],o.prototype,"eIconWrapper",void 0),m([e],o.prototype,"postConstruct",null),o}(o),E=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),b=function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,o,s):r(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},B=function(o){function n(){return o.call(this,n.TEMPLATE)||this}return E(n,o),n.prototype.setupResize=function(){var t=this.getGui(),e=this.resizeBar=new v;this.getContext().createBean(e),e.setElementToResize(t),this.appendChild(e)},n.prototype.getToolPanelId=function(){return this.toolPanelId},n.prototype.setToolPanelDef=function(t){var e=t.id,o=t.minWidth,n=t.maxWidth,r=t.width;this.toolPanelId=e,this.width=r;var i={api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()},s=this.userComponentFactory.newToolPanelComponent(t,i);null!=s?(s.then(this.setToolPanelComponent.bind(this)),null!=o&&this.resizeBar.setMinWidth(o),null!=n&&this.resizeBar.setMaxWidth(n)):console.warn("ag-grid: error processing tool panel component "+e+". You need to specify either 'toolPanel' or 'toolPanelFramework'")},n.prototype.setToolPanelComponent=function(t){var e=this;this.toolPanelCompInstance=t,this.appendChild(t.getGui()),this.addDestroyFunc((function(){e.destroyBean(t)})),this.width&&(this.getGui().style.width=this.width+"px")},n.prototype.getToolPanelInstance=function(){return this.toolPanelCompInstance},n.prototype.setResizerSizerSide=function(t){var e="left"===t,o=this.gridOptionsWrapper.isEnableRtl()?e:!e;this.resizeBar.setInverted(o)},n.prototype.refresh=function(){this.toolPanelCompInstance.refresh()},n.TEMPLATE='<div class="ag-tool-panel-wrapper"/>',b([t("userComponentFactory")],n.prototype,"userComponentFactory",void 0),b([e],n.prototype,"setupResize",null),n}(o),_=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),I=function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,o,s):r(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},O=function(o){function n(){var t=o.call(this,n.TEMPLATE)||this;return t.toolPanelWrappers=[],t}return _(n,o),n.prototype.postConstruct=function(){var t=this;this.sideBarButtonsComp.addEventListener(T.EVENT_SIDE_BAR_BUTTON_CLICKED,this.onToolPanelButtonClicked.bind(this)),this.setSideBarDef(),this.gridOptionsWrapper.addEventListener("sideBar",(function(){t.clearDownUi(),t.setSideBarDef()})),this.gridApi.registerSideBarComp(this)},n.prototype.onToolPanelButtonClicked=function(t){var e=t.toolPanelId;this.openedItem()===e?this.openToolPanel(void 0):this.openToolPanel(e)},n.prototype.clearDownUi=function(){this.sideBarButtonsComp.clearButtons(),this.destroyToolPanelWrappers()},n.prototype.setSideBarDef=function(){this.setDisplayed(!1);var t=this.gridOptionsWrapper.getSideBar(),e=!!t&&!!t.toolPanels;if(e){var o=e&&!t.hiddenByDefault;this.setDisplayed(o);var n=t.toolPanels;this.sideBarButtonsComp.setToolPanelDefs(n),this.setupToolPanels(n),this.setSideBarPosition(t.position),t.hiddenByDefault||this.openToolPanel(t.defaultToolPanel)}},n.prototype.setSideBarPosition=function(t){t||(t="right");var e="left"===t,o=e?"right":"left",n=this.getGui();return r.addOrRemoveCssClass(n,"ag-side-bar-left",e),r.addOrRemoveCssClass(n,"ag-side-bar-right",!e),this.toolPanelWrappers.forEach((function(t){t.setResizerSizerSide(o)})),this},n.prototype.setupToolPanels=function(t){var e=this;t.forEach((function(t){if(null!=t.id){if("agColumnsToolPanel"===t.toolPanel)if(!a.assertRegistered(l.ColumnToolPanelModule,"Column Tool Panel"))return;if("agFiltersToolPanel"===t.toolPanel)if(!a.assertRegistered(l.FiltersToolPanelModule,"Filters Tool Panel"))return;var o=new B;e.getContext().createBean(o),o.setToolPanelDef(t),o.setDisplayed(!1),e.getGui().appendChild(o.getGui()),e.toolPanelWrappers.push(o)}else console.warn("ag-grid: please review all your toolPanel components, it seems like at least one of them doesn't have an id")}))},n.prototype.refresh=function(){this.toolPanelWrappers.forEach((function(t){return t.refresh()}))},n.prototype.openToolPanel=function(t){var e=this.openedItem();e!==t&&(this.toolPanelWrappers.forEach((function(e){var o=t===e.getToolPanelId();e.setDisplayed(o)})),e!==this.openedItem()&&(this.sideBarButtonsComp.setActiveButton(t),this.raiseToolPanelVisibleEvent(t)))},n.prototype.getToolPanelInstance=function(t){var e=this.toolPanelWrappers.filter((function(e){return e.getToolPanelId()===t}))[0];if(e)return e.getToolPanelInstance();console.warn("ag-grid: unable to lookup Tool Panel as invalid key supplied: "+t)},n.prototype.raiseToolPanelVisibleEvent=function(t){var e={type:p.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:t,api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()};this.eventService.dispatchEvent(e)},n.prototype.close=function(){this.openToolPanel(void 0)},n.prototype.isToolPanelShowing=function(){return!!this.openedItem()},n.prototype.openedItem=function(){var t=null;return this.toolPanelWrappers.forEach((function(e){e.isDisplayed()&&(t=e.getToolPanelId())})),t},n.prototype.destroyToolPanelWrappers=function(){var t=this;this.toolPanelWrappers.forEach((function(e){r.removeFromParent(e.getGui()),t.destroyBean(e)})),this.toolPanelWrappers.length=0},n.prototype.destroy=function(){this.destroyToolPanelWrappers(),o.prototype.destroy.call(this)},n.TEMPLATE='<div class="ag-side-bar ag-unselectable">\n            <ag-side-bar-buttons ref="sideBarButtons"></ag-side-bar-buttons>\n        </div>',I([s("sideBarButtons")],n.prototype,"sideBarButtonsComp",void 0),I([t("gridApi")],n.prototype,"gridApi",void 0),I([e],n.prototype,"postConstruct",null),n}(o),D=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),R=function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,o,s):r(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},w=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.isColGroupDef=function(t){return t&&void 0!==t.children},t.getId=function(e){return t.isColGroupDef(e)?e.groupId:e.colId},t}return D(o,e),o.prototype.createColumnTree=function(t){var e=this,o=[],n=function(t,r){if(e.isColGroupDef(t)){var i=t,s=void 0!==i.groupId?i.groupId:i.headerName,a=new d(i,s,!1,r),l=[];return i.children.forEach((function(t){var e=n(t,r+1);e&&l.push(e)})),a.setChildren(l),a}var p=t,u=p.colId?p.colId:p.field,c=e.columnModel.getPrimaryColumn(u);return c||o.push(p),c},r=[];return t.forEach((function(t){var e=n(t,0);e&&r.push(e)})),o.length>0&&console.warn("AG Grid: unable to find grid columns for the supplied colDef(s):",o),r},o.prototype.syncLayoutWithGrid=function(t){var e=this.getLeafPathTrees();t(this.mergeLeafPathTrees(e))},o.prototype.getLeafPathTrees=function(){var t=function(e,o){var n;if(e instanceof d)if(e.isPadding())n=o;else{var i=r.assign({},e.getColGroupDef());i.groupId=e.getGroupId(),i.children=[o],n=i}else{var s=r.assign({},e.getColDef());s.colId=e.getColId(),n=s}var a=e.getOriginalParent();return a?t(a,n):n};return this.columnModel.getAllGridColumns().filter((function(t){var e=t.getColDef();return t.isPrimary()&&!e.showRowGroup})).map((function(e){return t(e,e.getColDef())}))},o.prototype.mergeLeafPathTrees=function(t){for(var e,o,n=this,r=function(t,e){if(!n.isColGroupDef(e))return t;var o=t,i=e;if(i.children&&i.groupId&&n.addChildrenToGroup(o,i.groupId,i.children[0]))return o;return i.children.forEach((function(t){return r(o,t)})),o},i=[],s=1;s<=t.length;s++){var a=t[s-1],l=t[s];e=a,o=l,n.isColGroupDef(e)&&n.isColGroupDef(o)&&n.getId(e)===n.getId(o)?t[s]=r(a,l):i.push(a)}return i},o.prototype.addChildrenToGroup=function(t,e,o){var n=this;if(!this.isColGroupDef(t))return!0;var i=t,s=o;if(function(t,e){var o=t.children.map(n.getId),i=r.includes(o,n.getId(e)),s=r.last(t.children),a=s&&n.getId(s)!==n.getId(e);return i&&a}(i,s))return i.children.push(s),!0;if(i.groupId===e){var a=i.children.map(this.getId);if(!r.includes(a,this.getId(s)))return i.children.push(s),!0}return i.children.forEach((function(t){return n.addChildrenToGroup(t,e,o)})),!1},R([t("columnModel")],o.prototype,"columnModel",void 0),o=R([u("toolPanelColDefService")],o)}(c),W={moduleName:l.SideBarModule,beans:[w],agStackComponents:[{componentName:"AgHorizontalResize",componentClass:v},{componentName:"AgSideBar",componentClass:O},{componentName:"AgSideBarButtons",componentClass:T}],dependantModules:[f]};export{W as SideBarModule,w as ToolPanelColDefService};