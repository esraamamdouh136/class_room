/**
 * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.0.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("@ag-grid-community/core"),o=require("@ag-grid-enterprise/core"),n=(t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)},function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}),r=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},i=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return n(o,t),o.prototype.execute=function(t){var o=e._.missingOrEmpty(this.columnModel.getValueColumns()),n=!this.gridOptionsWrapper.getGroupRowAggNodesFunc(),r=t.changedPath&&t.changedPath.isActive();if(!(o&&n&&r)){var i=this.createAggDetails(t);this.recursivelyCreateAggData(i)}},o.prototype.createAggDetails=function(t){var e=this.columnModel.isPivotActive(),o=this.columnModel.getValueColumns(),n=e?this.columnModel.getPivotColumns():[];return{changedPath:t.changedPath,valueColumns:o,pivotColumns:n}},o.prototype.recursivelyCreateAggData=function(t){var e=this;this.filteredOnly=!this.gridOptionsWrapper.isSuppressAggFilteredOnly();t.changedPath.forEachChangedNodeDepthFirst((function(o){if(!o.hasChildren())o.aggData&&o.setAggData(null);else{if(-1===o.level){var n=!e.columnModel.isPivotMode();if(e.gridOptionsWrapper.isSuppressAggAtRootLevel()&&n)return}e.aggregateRowNode(o,t)}}),!0)},o.prototype.aggregateRowNode=function(t,e){var o,n=0===e.valueColumns.length,r=0===e.pivotColumns.length,i=this.gridOptionsWrapper.getGroupRowAggNodesFunc();o=i?i(t.childrenAfterFilter):n?null:r?this.aggregateRowNodeUsingValuesOnly(t,e):this.aggregateRowNodeUsingValuesAndPivot(t),t.setAggData(o),t.sibling&&t.sibling.setAggData(o)},o.prototype.aggregateRowNodeUsingValuesAndPivot=function(t){var o=this,n={},r=this.pivotStage.getPivotColumnDefs();return r.filter((function(t){return!e._.exists(t.pivotTotalColumnIds)})).forEach((function(e){var r,i=e.pivotKeys||[],a=e.pivotValueColumn,s=e.colId;r=t.leafGroup?o.getValuesFromMappedSet(t.childrenMapped,i,a):o.getValuesPivotNonLeaf(t,s),n[s]=o.aggregateValues(r,a.getAggFunc(),a,t)})),r.filter((function(t){return e._.exists(t.pivotTotalColumnIds)})).forEach((function(e){var r=[],i=e.pivotValueColumn,a=e.pivotTotalColumnIds,s=e.colId;a&&a.length&&(a.forEach((function(t){r.push(n[t])})),n[s]=o.aggregateValues(r,i.getAggFunc(),i,t))})),n},o.prototype.aggregateRowNodeUsingValuesOnly=function(t,e){var o=this,n={},r=e.changedPath.isActive()?e.changedPath.getValueColumnsForNode(t,e.valueColumns):e.valueColumns,i=e.changedPath.isActive()?e.changedPath.getNotValueColumnsForNode(t,e.valueColumns):null,a=this.getValuesNormal(t,r),s=t.aggData;return r.forEach((function(e,r){n[e.getId()]=o.aggregateValues(a[r],e.getAggFunc(),e,t)})),i&&s&&i.forEach((function(t){n[t.getId()]=s[t.getId()]})),n},o.prototype.getValuesPivotNonLeaf=function(t,e){var o=[];return t.childrenAfterFilter.forEach((function(t){var n=t.aggData[e];o.push(n)})),o},o.prototype.getValuesFromMappedSet=function(t,e,o){var n=this,r=t;if(e.forEach((function(t){return r=r?r[t]:null})),!r)return[];var i=[];return r.forEach((function(t){var e=n.valueService.getValue(o,t);i.push(e)})),i},o.prototype.getValuesNormal=function(t,e){var o=[];e.forEach((function(){return o.push([])}));for(var n=e.length,r=this.filteredOnly?t.childrenAfterFilter:t.childrenAfterGroup,i=r.length,a=0;a<i;a++)for(var s=r[a],u=0;u<n;u++){var p=e[u],l=this.valueService.getValue(p,s);o[u].push(l)}return o},o.prototype.aggregateValues=function(t,o,n,r){var i="string"==typeof o?this.aggFuncService.getAggFunc(o):o;if("function"!=typeof i)return console.error("AG Grid: unrecognised aggregation function "+o),null;var a=function(){e._.doOnce((function(){console.warn("AG Grid: since v24.0, custom aggregation functions take a params object. Please alter your aggregation function to use params.values")}),"aggregationStage.aggregateValues Deprecation")};return i({values:t,column:n,colDef:n?n.getColDef():void 0,rowNode:r,data:r?r.data:void 0,api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsWrapper.getContext(),forEach:function(e,o){return a(),t.forEach(e,o)},get length(){return a(),t.length},set length(e){a(),t.length=e}})},r([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),r([e.Autowired("valueService")],o.prototype,"valueService",void 0),r([e.Autowired("pivotStage")],o.prototype,"pivotStage",void 0),r([e.Autowired("aggFuncService")],o.prototype,"aggFuncService",void 0),r([e.Autowired("gridApi")],o.prototype,"gridApi",void 0),r([e.Autowired("columnApi")],o.prototype,"columnApi",void 0),o=r([e.Bean("aggregationStage")],o)}(e.BeanStub),a=function(){function t(){this.allSets={},this.allParents=[]}return t.prototype.removeFromChildrenAfterGroup=function(t,e){this.getSet(t).removeFromChildrenAfterGroup[e.id]=!0},t.prototype.removeFromAllLeafChildren=function(t,e){this.getSet(t).removeFromAllLeafChildren[e.id]=!0},t.prototype.getSet=function(t){return this.allSets[t.id]||(this.allSets[t.id]={removeFromAllLeafChildren:{},removeFromChildrenAfterGroup:{}},this.allParents.push(t)),this.allSets[t.id]},t.prototype.getAllParents=function(){return this.allParents},t.prototype.flush=function(){var t=this;this.allParents.forEach((function(e){var o=t.allSets[e.id];e.childrenAfterGroup=e.childrenAfterGroup.filter((function(t){return!o.removeFromChildrenAfterGroup[t.id]})),e.allLeafChildren=e.allLeafChildren.filter((function(t){return!o.removeFromAllLeafChildren[t.id]})),e.updateHasChildren()})),this.allSets={},this.allParents.length=0},t}(),s=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),u=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},p=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.groupIdSequence=new e.NumberSequence,o}return s(o,t),o.prototype.postConstruct=function(){this.usingTreeData=this.gridOptionsWrapper.isTreeData(),this.usingTreeData&&(this.getDataPath=this.gridOptionsWrapper.getDataPathFunc())},o.prototype.execute=function(t){var e=this.createGroupingDetails(t);if(e.transactions)this.handleTransaction(e);else{var o=!0===t.afterColumnsChanged;this.shotgunResetEverything(e,o)}this.sortGroupsWithComparator(e.rootNode),this.selectableService.updateSelectableAfterGrouping(e.rootNode)},o.prototype.createGroupingDetails=function(t){var e=t.rowNode,o=t.changedPath,n=t.rowNodeTransactions,r=t.rowNodeOrder,i=this.usingTreeData?null:this.columnModel.getRowGroupColumns();return{includeParents:!this.gridOptionsWrapper.isSuppressParentsInRowNodes(),expandByDefault:this.gridOptionsWrapper.getGroupDefaultExpanded(),groupedCols:i,rootNode:e,pivotMode:this.columnModel.isPivotMode(),groupedColCount:this.usingTreeData||!i?0:i.length,rowNodeOrder:r,transactions:n,changedPath:o}},o.prototype.handleTransaction=function(t){var o=this;t.transactions.forEach((function(n){var r=o.usingTreeData?void 0:new a;if(e._.existsAndNotEmpty(n.remove)&&o.removeNodes(n.remove,t,r),e._.existsAndNotEmpty(n.update)&&o.moveNodesInWrongPath(n.update,t,r),e._.existsAndNotEmpty(n.add)&&o.insertNodes(n.add,t,!1),r){var i=r.getAllParents().slice();r.flush(),o.removeEmptyGroups(i,t)}})),t.rowNodeOrder&&this.sortChildren(t)},o.prototype.sortChildren=function(t){t.changedPath.forEachChangedNodeDepthFirst((function(o){e._.sortRowNodesByOrder(o.childrenAfterGroup,t.rowNodeOrder)}))},o.prototype.sortGroupsWithComparator=function(t){if(!this.usingTreeData){var o=this.gridOptionsWrapper.getDefaultGroupOrderComparator();e._.exists(o)&&function t(n){e._.exists(n.childrenAfterGroup)&&!n.leafGroup&&(n.childrenAfterGroup.sort(o),n.childrenAfterGroup.forEach((function(e){return t(e)})))}(t)}},o.prototype.getExistingPathForNode=function(t,e){for(var o=[],n=this.usingTreeData?t:t.parent;n&&n!==e.rootNode;)o.push({key:n.key,rowGroupColumn:n.rowGroupColumn,field:n.field}),n=n.parent;return o.reverse(),o},o.prototype.moveNodesInWrongPath=function(t,o,n){var r=this;t.forEach((function(t){o.changedPath.isActive()&&o.changedPath.addParentNode(t.parent);var i=function(t){return t.key},a=r.getExistingPathForNode(t,o).map(i),s=r.getGroupInfo(t,o).map(i);e._.areEqual(a,s)||r.moveNode(t,o,n)}))},o.prototype.moveNode=function(t,e,o){if(this.removeNodesInStages([t],e,o),this.insertOneNode(t,e,!0),t.setData(t.data),e.changedPath.isActive()){var n=t.parent;e.changedPath.addParentNode(n)}},o.prototype.removeNodes=function(t,e,o){this.removeNodesInStages(t,e,o),e.changedPath.isActive()&&t.forEach((function(t){return e.changedPath.addParentNode(t.parent)}))},o.prototype.removeNodesInStages=function(t,e,o){if(this.removeNodesFromParents(t,e,o),this.usingTreeData){this.postRemoveCreateFillerNodes(t,e);var n=t.map((function(t){return t.parent}));this.removeEmptyGroups(n,e)}},o.prototype.forEachParentGroup=function(t,e,o){for(var n=e;n&&n!==t.rootNode;)o(n),n=n.parent},o.prototype.removeNodesFromParents=function(t,e,o){var n=this,r=null==o,i=o||new a;t.forEach((function(t){n.removeFromParent(t,i),n.forEachParentGroup(e,t.parent,(function(e){i.removeFromAllLeafChildren(e,t)}))})),r&&i.flush()},o.prototype.postRemoveCreateFillerNodes=function(t,e){var o=this;t.forEach((function(t){if(t.hasChildren()){var n=o.getExistingPathForNode(t,e),r=o.findParentForNode(t,n,e);r.expanded=t.expanded,r.allLeafChildren=t.allLeafChildren,r.childrenAfterGroup=t.childrenAfterGroup,r.childrenMapped=t.childrenMapped,r.updateHasChildren(),r.childrenAfterGroup.forEach((function(t){return t.parent=r}))}}))},o.prototype.removeEmptyGroups=function(t,e){for(var o=this,n=!0,r=function(){n=!1;var r=new a;t.forEach((function(t){o.forEachParentGroup(e,t,(function(t){(function(t){var e=o.getChildrenMappedKey(t.key,t.rowGroupColumn),n=t.parent;return!(!n||!n.childrenMapped||!n.childrenMapped[e])&&!!t.isEmptyRowGroupNode()})(t)&&(n=!0,o.removeFromParent(t,r),t.setSelected(!1))}))})),r.flush()};n;)r()},o.prototype.removeFromParent=function(t,o){t.parent&&(o?o.removeFromChildrenAfterGroup(t.parent,t):(e._.removeFromArray(t.parent.childrenAfterGroup,t),t.parent.updateHasChildren()));var n=this.getChildrenMappedKey(t.key,t.rowGroupColumn);t.parent&&t.parent.childrenMapped&&(t.parent.childrenMapped[n]=void 0),t.setRowTop(null),t.setRowIndex(null)},o.prototype.addToParent=function(t,e){var o=this.getChildrenMappedKey(t.key,t.rowGroupColumn);e&&(e.childrenMapped&&(e.childrenMapped[o]=t),e.childrenAfterGroup.push(t),e.updateHasChildren())},o.prototype.areGroupColsEqual=function(t,o){return null!=t&&null!=o&&t.pivotMode===o.pivotMode&&e._.areEqual(t.groupedCols,o.groupedCols)},o.prototype.checkAllGroupDataAfterColsChanged=function(t){var e=this,o=function(t){t&&t.forEach((function(t){if(!(!e.usingTreeData&&!t.group)){var n={field:t.field,key:t.key,rowGroupColumn:t.rowGroupColumn};e.setGroupData(t,n),o(t.childrenAfterGroup)}}))};o(t.rootNode.childrenAfterGroup)},o.prototype.shotgunResetEverything=function(t,e){this.processAfterColumnsChanged(t,e)||(t.rootNode.leafGroup=!this.usingTreeData&&0===t.groupedCols.length,t.rootNode.childrenAfterGroup=[],t.rootNode.childrenMapped={},t.rootNode.updateHasChildren(),this.insertNodes(t.rootNode.allLeafChildren,t,!1))},o.prototype.processAfterColumnsChanged=function(t,e){var o=!1,n=this.columnModel.getGroupDisplayColumns(),r=n?n.map((function(t){return t.getId()})).join("-"):"";return e&&(o=this.usingTreeData||this.areGroupColsEqual(t,this.oldGroupingDetails),this.oldGroupDisplayColIds!==r&&this.checkAllGroupDataAfterColsChanged(t)),this.oldGroupingDetails=t,this.oldGroupDisplayColIds=r,o},o.prototype.insertNodes=function(t,e,o){var n=this;t.forEach((function(t){n.insertOneNode(t,e,o),e.changedPath.isActive()&&e.changedPath.addParentNode(t.parent)}))},o.prototype.insertOneNode=function(t,e,o){var n=this.getGroupInfo(t,e),r=this.findParentForNode(t,n,e);r.group||console.warn("AG Grid: duplicate group keys for row data, keys should be unique",[r.data,t.data]),this.usingTreeData?this.swapGroupWithUserNode(r,t,o):(t.parent=r,t.level=n.length,r.childrenAfterGroup.push(t),r.updateHasChildren())},o.prototype.findParentForNode=function(t,e,o){var n=this,r=o.rootNode;return e.forEach((function(e,i){(r=n.getOrCreateNextNode(r,e,i,o)).allLeafChildren.push(t)})),r},o.prototype.swapGroupWithUserNode=function(t,e,o){e.parent=t.parent,e.key=t.key,e.field=t.field,e.groupData=t.groupData,e.level=t.level,o||(e.expanded=t.expanded),e.leafGroup=t.leafGroup,e.rowGroupIndex=t.rowGroupIndex,e.allLeafChildren=t.allLeafChildren,e.childrenAfterGroup=t.childrenAfterGroup,e.childrenMapped=t.childrenMapped,e.updateHasChildren(),this.removeFromParent(t),e.childrenAfterGroup.forEach((function(t){return t.parent=e})),this.addToParent(e,t.parent)},o.prototype.getOrCreateNextNode=function(t,e,o,n){var r=this.getChildrenMappedKey(e.key,e.rowGroupColumn),i=t.childrenMapped,a=i&&i.hasOwnProperty(r)?i[r]:void 0;return a||(a=this.createGroup(e,t,o,n),this.addToParent(a,t)),a},o.prototype.createGroup=function(t,o,n,r){var i=new e.RowNode;return this.context.createBean(i),i.group=!0,i.field=t.field,i.rowGroupColumn=t.rowGroupColumn,this.setGroupData(i,t),i.id=e.RowNode.ID_PREFIX_ROW_GROUP+this.groupIdSequence.next(),i.key=t.key,i.level=n,i.leafGroup=!this.usingTreeData&&n===r.groupedColCount-1,i.allLeafChildren=[],i.setAllChildrenCount(0),i.rowGroupIndex=this.usingTreeData?null:n,i.childrenAfterGroup=[],i.childrenMapped={},i.updateHasChildren(),i.parent=r.includeParents?o:null,this.setExpandedInitialValue(r,i),i},o.prototype.setGroupData=function(t,e){var o=this;t.groupData={},this.columnModel.getGroupDisplayColumns().forEach((function(n){(o.usingTreeData||!!t.rowGroupColumn&&n.isRowGroupDisplayed(t.rowGroupColumn.getId()))&&(t.groupData[n.getColId()]=e.key)}))},o.prototype.getChildrenMappedKey=function(t,e){return e?e.getId()+"-"+t:t},o.prototype.setExpandedInitialValue=function(t,e){if(t.pivotMode&&e.leafGroup)e.expanded=!1;else{var o=this.gridOptionsWrapper.getIsGroupOpenByDefaultFunc();if(o){var n={rowNode:e,field:e.field,key:e.key,level:e.level,rowGroupColumn:e.rowGroupColumn};e.expanded=1==o(n)}else{var r=t.expandByDefault;-1!==t.expandByDefault?e.expanded=e.level<r:e.expanded=!0}}},o.prototype.getGroupInfo=function(t,e){return this.usingTreeData?this.getGroupInfoFromCallback(t):this.getGroupInfoFromGroupColumns(t,e)},o.prototype.getGroupInfoFromCallback=function(t){var o=this.getDataPath?this.getDataPath(t.data):null;null!=o&&0!==o.length||e._.doOnce((function(){return console.warn("getDataPath() should not return an empty path for data",t.data)}),"groupStage.getGroupInfoFromCallback");return o?o.map((function(t){return{key:t,field:null,rowGroupColumn:null}})):[]},o.prototype.getGroupInfoFromGroupColumns=function(t,e){var o=this,n=[];return e.groupedCols.forEach((function(r){var i=o.valueService.getKeyForNode(r,t),a=null!=i;if(e.pivotMode&&!a&&(i=" ",a=!0),a){var s={key:i,field:r.getColDef().field,rowGroupColumn:r};n.push(s)}})),n},u([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),u([e.Autowired("selectableService")],o.prototype,"selectableService",void 0),u([e.Autowired("valueService")],o.prototype,"valueService",void 0),u([e.PostConstruct],o.prototype,"postConstruct",null),o=u([e.Bean("groupStage")],o)}(e.BeanStub),l=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),c=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},d=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n},h=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}var n;return l(o,t),n=o,o.prototype.createPivotColumnDefs=function(t){var o=[],n=[],r=this.columnModel.getPivotColumns(),i=this.columnModel.getValueColumns(),a=r.length,s=new e.NumberSequence;return this.recursivelyAddGroup(o,n,1,t,[],s,a,r),this.addRowGroupTotals(o,n,i,s),this.addExpandablePivotGroups(o,n,s),this.addPivotTotalsToGroups(o,n,s),{pivotColumnGroupDefs:o,pivotColumnDefs:n.map((function(t){return e._.cloneObject(t)}))}},o.prototype.recursivelyAddGroup=function(t,o,n,r,i,a,s,u){var p=this;e._.iterateObject(r,(function(e,r){var l=d(i,[e]);if(n!==s){var c={children:[],headerName:e,pivotKeys:l,columnGroupShow:"open",groupId:"pivot"+a.next()};t.push(c),p.recursivelyAddGroup(c.children,o,n+1,r,l,a,s,u)}else{var h=p.columnModel.getValueColumns(),g={children:[],headerName:e,pivotKeys:l,columnGroupShow:"open",groupId:"pivot"+a.next()};if(0===h.length){var f=p.createColDef(null,"-",l,a);g.children.push(f),o.push(f)}else h.forEach((function(t){var e=p.columnModel.getDisplayNameForColumn(t,"header"),n=p.createColDef(t,e,l,a);n.columnGroupShow="open",g.children.push(n),o.push(n)}));t.push(g)}}));var l=u[n-1].getColDef().pivotComparator,c=this.headerNameComparator.bind(this,l);t.sort(c)},o.prototype.addExpandablePivotGroups=function(t,e,o){var n=this;if(!this.gridOptionsWrapper.isSuppressExpandablePivotGroups()&&!this.gridOptionsWrapper.getPivotColumnGroupTotals()){var r=function(t,e,o,i){var a=t;if(a.children){var s=new Map;a.children.forEach((function(t){r(t,e,o,s)}));var u=!a.children.some((function(t){return t.children}));n.columnModel.getValueColumns().forEach((function(r){var i=n.columnModel.getDisplayNameForColumn(r,"header"),a=n.createColDef(r,i,t.pivotKeys,o);(a.pivotTotalColumnIds=s.get(r.getColId()),a.columnGroupShow="closed",a.aggFunc=r.getAggFunc(),u)||(t.children.push(a),e.push(a))})),n.merge(i,s)}else{var p=t;if(!p.pivotValueColumn)return;var l=p.pivotValueColumn.getColId(),c=i.has(l)?i.get(l):[];c.push(p.colId),i.set(l,c)}};t.forEach((function(t){r(t,e,o,new Map)}))}},o.prototype.addPivotTotalsToGroups=function(t,e,o){var n=this;if(this.gridOptionsWrapper.getPivotColumnGroupTotals()){var r="after"===this.gridOptionsWrapper.getPivotColumnGroupTotals(),i=this.columnModel.getValueColumns(),a=i.map((function(t){return t.getAggFunc()}));if(a&&!(a.length<1)&&this.sameAggFuncs(a)){var s=i[0];t.forEach((function(t){n.recursivelyAddPivotTotal(t,e,o,s,r)}))}}},o.prototype.recursivelyAddPivotTotal=function(t,e,o,n,r){var i=this,a=t;if(!a.children){var s=t;return s.colId?[s.colId]:null}var u=[];if(a.children.forEach((function(t){var a=i.recursivelyAddPivotTotal(t,e,o,n,r);a&&(u=u.concat(a))})),a.children.length>1){var p=this.gridOptionsWrapper.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),l=this.createColDef(n,p,t.pivotKeys,o);l.pivotTotalColumnIds=u,l.aggFunc=n.getAggFunc();var c=t.children;r?c.push(l):c.unshift(l),e.push(l)}return u},o.prototype.addRowGroupTotals=function(t,e,o,n){var r=this;if(this.gridOptionsWrapper.getPivotRowTotals())for(var i="after"===this.gridOptionsWrapper.getPivotRowTotals(),a=i?o.slice():o.slice().reverse(),s=function(o){var s=a[o],p=[];t.forEach((function(t){p=p.concat(r.extractColIdsForValueColumn(t,s))})),u.createRowGroupTotal(t,e,[],n,s,p,i)},u=this,p=0;p<a.length;p++)s(p)},o.prototype.extractColIdsForValueColumn=function(t,e){var o=this,n=t;if(!n.children){var r=n;return r.pivotValueColumn===e&&r.colId?[r.colId]:[]}var i=[];return n.children.forEach((function(t){o.extractColIdsForValueColumn(t,e);var n=o.extractColIdsForValueColumn(t,e);i=i.concat(n)})),i},o.prototype.createRowGroupTotal=function(t,e,o,r,i,a,s){var u=o.slice(0),p=this.columnModel.getValueColumns(),l={children:[],pivotKeys:u,groupId:n.PIVOT_ROW_TOTAL_PREFIX+r.next()};if(0===p.length){var c=this.createColDef(null,"-",u,r);l.children.push(c),e.push(c)}else{var d=this.columnModel.getDisplayNameForColumn(i,"header");(c=this.createColDef(i,d,u,r)).pivotTotalColumnIds=a,l.children.push(c),e.push(c)}s?t.push(l):t.unshift(l)},o.prototype.createColDef=function(t,o,n,r){var i={};if(t){var a=t.getColDef();e._.assign(i,a),i.hide=!1}return i.headerName=o,i.colId="pivot_"+r.next(),i.field=i.colId,i.pivotKeys=n,i.pivotValueColumn=t,i.filter=!1,i},o.prototype.sameAggFuncs=function(t){if(1==t.length)return!0;for(var e=1;e<t.length;e++)if(t[e]!==t[0])return!1;return!0},o.prototype.headerNameComparator=function(t,e,o){return t?t(e.headerName,o.headerName):e.headerName&&!o.headerName?1:!e.headerName&&o.headerName?-1:e.headerName&&o.headerName?e.headerName<o.headerName?-1:e.headerName>o.headerName?1:0:0},o.prototype.merge=function(t,e){e.forEach((function(e,o,n){var r=t.has(o)?t.get(o):[],i=d(r,e);t.set(o,i)}))},o.PIVOT_ROW_TOTAL_PREFIX="PivotRowTotal_",c([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),o=n=c([e.Bean("pivotColDefService")],o)}(e.BeanStub),g=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),f=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},v=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.uniqueValues={},e}return g(o,t),o.prototype.execute=function(t){var e=t.rowNode,o=t.changedPath;this.columnModel.isPivotActive()?this.executePivotOn(e,o):this.executePivotOff(o)},o.prototype.executePivotOff=function(t){this.aggregationColumnsHashLastTime=null,this.uniqueValues={},this.columnModel.isSecondaryColumnsPresent()&&(this.columnModel.setSecondaryColumns(null,"rowModelUpdated"),t&&t.setInactive())},o.prototype.executePivotOn=function(t,e){var o=this.bucketUpRowNodes(t),n=this.setUniqueValues(o),r=this.columnModel.getValueColumns(),i=r.map((function(t){return t.getId()})).join("#"),a=r.map((function(t){return t.getAggFunc().toString()})).join("#"),s=this.aggregationColumnsHashLastTime!==i,u=this.aggregationFuncsHashLastTime!==a;if(this.aggregationColumnsHashLastTime=i,this.aggregationFuncsHashLastTime=a,n||s||u){var p=this.pivotColDefService.createPivotColumnDefs(this.uniqueValues),l=p.pivotColumnGroupDefs,c=p.pivotColumnDefs;this.pivotColumnDefs=c,this.columnModel.setSecondaryColumns(l,"rowModelUpdated"),e&&e.setInactive()}},o.prototype.setUniqueValues=function(t){return!!(JSON.stringify(t)!==JSON.stringify(this.uniqueValues))&&(this.uniqueValues=t,!0)},o.prototype.bucketUpRowNodes=function(t){var e=this,o={},n=function(t){t.leafGroup?e.bucketRowNode(t,o):t.childrenAfterFilter.forEach((function(t){n(t)}))};return n(t),o},o.prototype.bucketRowNode=function(t,e){var o=this.columnModel.getPivotColumns();0!==o.length?t.childrenMapped=this.bucketChildren(t.childrenAfterFilter,o,0,e):t.childrenMapped=null},o.prototype.bucketChildren=function(t,o,n,r){var i=this,a={},s=o[n];if(t.forEach((function(t){var o=i.valueService.getKeyForNode(s,t);e._.missing(o)&&(o=""),r[o]||(r[o]={}),a[o]||(a[o]=[]),a[o].push(t)})),n===o.length-1)return a;var u={};return e._.iterateObject(a,(function(t,e){u[t]=i.bucketChildren(e,o,n+1,r[t])})),u},o.prototype.getPivotColumnDefs=function(){return this.pivotColumnDefs},f([e.Autowired("valueService")],o.prototype,"valueService",void 0),f([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),f([e.Autowired("pivotColDefService")],o.prototype,"pivotColDefService",void 0),o=f([e.Bean("pivotStage")],o)}(e.BeanStub),m=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),y=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},C="undefined"==typeof BigInt?null:BigInt,A=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.aggFuncsMap={},e.initialised=!1,e}var n;return m(o,t),n=o,o.prototype.init=function(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gridOptionsWrapper.getAggFuncs()))},o.prototype.initialiseWithDefaultAggregations=function(){this.aggFuncsMap[n.AGG_SUM]=D,this.aggFuncsMap[n.AGG_FIRST]=G,this.aggFuncsMap[n.AGG_LAST]=_,this.aggFuncsMap[n.AGG_MIN]=E,this.aggFuncsMap[n.AGG_MAX]=O,this.aggFuncsMap[n.AGG_COUNT]=N,this.aggFuncsMap[n.AGG_AVG]=P,this.initialised=!0},o.prototype.getDefaultAggFunc=function(t){var o=this.getFuncNames(t),r=e._.includes(o,n.AGG_SUM),i=e._.exists(this.aggFuncsMap[n.AGG_SUM]);return r&&i?n.AGG_SUM:e._.existsAndNotEmpty(o)?o[0]:null},o.prototype.addAggFuncs=function(t){e._.iterateObject(t,this.addAggFunc.bind(this))},o.prototype.addAggFunc=function(t,e){this.init(),this.aggFuncsMap[t]=e},o.prototype.getAggFunc=function(t){return this.init(),this.aggFuncsMap[t]},o.prototype.getFuncNames=function(t){var e=t.getColDef().allowedAggFuncs;return null==e?Object.keys(this.aggFuncsMap).sort():e},o.prototype.clear=function(){this.aggFuncsMap={}},o.AGG_SUM="sum",o.AGG_FIRST="first",o.AGG_LAST="last",o.AGG_MIN="min",o.AGG_MAX="max",o.AGG_COUNT="count",o.AGG_AVG="avg",y([e.PostConstruct],o.prototype,"init",null),o=n=y([e.Bean("aggFuncService")],o)}(e.BeanStub);function D(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"==typeof r?null===o?o=r:o+=C?"number"==typeof o?r:C(r):r:"bigint"==typeof r&&(o=null===o?r:("bigint"==typeof o?o:C(o))+r)}return o}function G(t){return t.values.length>0?t.values[0]:null}function _(t){return t.values.length>0?e._.last(t.values):null}function E(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o>r)||(o=r)}return o}function O(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o<r)||(o=r)}return o}function N(t){for(var e=t.values,o=0,n=0;n<e.length;n++){var r=e[n];o+=null!=r&&"number"==typeof r.value?r.value:1}return{value:o,toString:function(){return this.value.toString()},toNumber:function(){return this.value}}}function P(t){for(var e=t.values,o=0,n=0,r=0;r<e.length;r++){var i=e[r],a=null;"number"==typeof i||"bigint"==typeof i?(a=i,n++):null==i||"number"!=typeof i.value&&"bigint"!=typeof i.value||"number"!=typeof i.count||(a=C?i.value*("number"==typeof i.value?i.count:C(i.count)):i.value*i.count,n+=i.count),"number"==typeof a?o+=C?"number"==typeof o?a:C(a):a:"bigint"==typeof a&&(o=("bigint"==typeof o?o:C(o))+a)}var s=null;return n>0&&(s=C?o/("number"==typeof o?n:C(n)):o/n),{count:n,value:s,toString:function(){return"number"==typeof this.value||"bigint"==typeof this.value?this.value.toString():""},toNumber:function(){return this.value}}}var S=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),w=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},T=function(t){function o(e,o,n,r,i){var a=t.call(this)||this;return a.column=e,a.dragSourceDropTarget=o,a.ghost=n,a.valueColumn=r,a.horizontal=i,a.popupShowing=!1,a}return S(o,t),o.prototype.init=function(){this.setTemplate(o.TEMPLATE),this.addElementClasses(this.getGui()),this.addElementClasses(this.eDragHandle,"drag-handle"),this.addElementClasses(this.eText,"text"),this.addElementClasses(this.eButton,"button"),this.eDragHandle.appendChild(e._.createIconNoSpan("columnDrag",this.gridOptionsWrapper)),this.eButton.appendChild(e._.createIconNoSpan("cancel",this.gridOptionsWrapper)),this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnDrop"),this.setupComponents(),this.ghost||this.gridOptionsWrapper.isFunctionsReadOnly()||this.addDragSource(),this.setupTooltip()},o.prototype.setupTooltip=function(){var t=this,o=function(){var e=t.column.getColDef().headerTooltip;t.setTooltip(e)};o(),this.addManagedListener(this.eventService,e.Events.EVENT_NEW_COLUMNS_LOADED,o)},o.prototype.addDragSource=function(){var t=this,o={type:e.DragSourceType.ToolPanel,eElement:this.eDragHandle,defaultIconName:e.DragAndDropService.ICON_HIDE,getDragItem:function(){return t.createDragItem()},dragItemName:this.displayName,dragSourceDropTarget:this.dragSourceDropTarget};this.dragAndDropService.addDragSource(o,!0),this.addDestroyFunc((function(){return t.dragAndDropService.removeDragSource(o)}))},o.prototype.createDragItem=function(){var t={};return t[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:t}},o.prototype.setupComponents=function(){this.setTextValue(),this.setupRemove(),this.ghost&&e._.addCssClass(this.getGui(),"ag-column-drop-cell-ghost"),this.valueColumn&&!this.gridOptionsWrapper.isFunctionsReadOnly()&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))},o.prototype.setupRemove=function(){var t=this;e._.setDisplayed(this.eButton,!this.gridOptionsWrapper.isFunctionsReadOnly()),this.addManagedListener(this.eButton,"click",(function(e){var n={type:o.EVENT_COLUMN_REMOVE};t.dispatchEvent(n),e.stopPropagation()}));var n=new e.TouchListener(this.eButton);this.addManagedListener(n,e.TouchListener.EVENT_TAP,(function(e){var n={type:o.EVENT_COLUMN_REMOVE};t.dispatchEvent(n)})),this.addDestroyFunc(n.destroy.bind(n))},o.prototype.setTextValue=function(){var t;if(this.valueColumn){var o=this.column.getAggFunc(),n="string"==typeof o?o:"agg";t=this.gridOptionsWrapper.getLocaleTextFunc()(n,n)+"("+this.displayName+")"}else t=this.displayName;var r=e._.escapeString(t);this.eText.innerHTML=r},o.prototype.onShowAggFuncSelection=function(){var t=this;if(!this.popupShowing){this.popupShowing=!0;var o=new e.VirtualList("select-agg-func"),n=this.aggFuncService.getFuncNames(this.column);o.setModel({getRow:function(t){return n[t]},getRowCount:function(){return n.length}}),this.getContext().createBean(o);var r=e._.loadTemplate('<div class="ag-select-agg-func-popup"></div>');r.style.top="0px",r.style.left="0px",r.appendChild(o.getGui()),r.style.width=this.getGui().clientWidth+"px";var i=this.popupService.addPopup({modal:!0,eChild:r,closeOnEsc:!0,closedCallback:function(){t.destroyBean(o),t.popupShowing=!1}});i&&o.setComponentCreator(this.createAggSelect.bind(this,i.hideFunc)),this.popupService.positionPopupUnderComponent({type:"aggFuncSelect",eventSource:this.getGui(),ePopup:r,keepWithinBounds:!0,column:this.column}),o.refresh()}},o.prototype.createAggSelect=function(t,o){var n=this,r=this.gridOptionsWrapper.getLocaleTextFunc(),i=o.toString(),a=r(i,i);return new b((function(){if(t(),n.gridOptionsWrapper.isFunctionsPassive()){var r={type:e.Events.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,columns:[n.column],aggFunc:o,api:n.gridApi,columnApi:n.columnApi};n.eventService.dispatchEvent(r)}else n.columnModel.setColumnAggFunc(n.column,o,"toolPanelDragAndDrop")}),a)},o.prototype.addElementClasses=function(t,o){o=o?"-"+o:"",e._.addCssClass(t,"ag-column-drop-cell"+o);var n=this.horizontal?"horizontal":"vertical";e._.addCssClass(t,"ag-column-drop-"+n+"-cell"+o)},o.EVENT_COLUMN_REMOVE="columnRemove",o.TEMPLATE='<span>\n          <span ref="eDragHandle" class="ag-drag-handle ag-column-drop-cell-drag-handle"></span>\n          <span ref="eText" class="ag-column-drop-cell-text"></span>\n          <span ref="eButton" class="ag-column-drop-cell-button"></span>\n        </span>',w([e.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),w([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),w([e.Autowired("popupService")],o.prototype,"popupService",void 0),w([e.Optional("aggFuncService")],o.prototype,"aggFuncService",void 0),w([e.Autowired("columnApi")],o.prototype,"columnApi",void 0),w([e.Autowired("gridApi")],o.prototype,"gridApi",void 0),w([e.RefSelector("eText")],o.prototype,"eText",void 0),w([e.RefSelector("eDragHandle")],o.prototype,"eDragHandle",void 0),w([e.RefSelector("eButton")],o.prototype,"eButton",void 0),w([e.PostConstruct],o.prototype,"init",null),o}(e.Component),b=function(t){function e(e,o){var n=t.call(this,'<div class="ag-select-agg-func-item"/>')||this;return n.getGui().innerText=o,n.value=o,n.addGuiEventListener("click",e),n}return S(e,t),e}(e.Component),M=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),F=function(t){function o(e,n){var r=t.call(this,'<div class="ag-unselectable"></div>')||this;return r.horizontal=e,r.valueColumn=n,r.state=o.STATE_NOT_DRAGGING,r.guiDestroyFunctions=[],r.childColumnComponents=[],r.resizeEnabled=!1,r.addElementClasses(r.getGui()),r.eColumnDropList=document.createElement("div"),r.addElementClasses(r.eColumnDropList,"list"),r}return M(o,t),o.prototype.isHorizontal=function(){return this.horizontal},o.prototype.toggleResizable=function(t){this.positionableFeature.setResizable(!!t&&{bottom:!0}),this.resizeEnabled=t},o.prototype.setBeans=function(t){this.beans=t},o.prototype.destroy=function(){this.destroyGui(),t.prototype.destroy.call(this)},o.prototype.destroyGui=function(){this.guiDestroyFunctions.forEach((function(t){return t()})),this.guiDestroyFunctions.length=0,this.childColumnComponents.length=0,e._.clearElement(this.getGui()),e._.clearElement(this.eColumnDropList)},o.prototype.init=function(t){this.params=t,this.addManagedListener(this.beans.eventService,e.Events.EVENT_NEW_COLUMNS_LOADED,this.refreshGui.bind(this)),this.addManagedListener(this.beans.gridOptionsWrapper,"functionsReadOnly",this.refreshGui.bind(this)),this.setupDropTarget(),this.positionableFeature=new e.PositionableFeature(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature),this.refreshGui()},o.prototype.addElementClasses=function(t,o){o=o?"-"+o:"",e._.addCssClass(t,"ag-column-drop"+o);var n=this.horizontal?"horizontal":"vertical";e._.addCssClass(t,"ag-column-drop-"+n+o)},o.prototype.setupDropTarget=function(){this.dropTarget={getContainer:this.getGui.bind(this),getIconName:this.getIconName.bind(this),onDragging:this.onDragging.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragStop:this.onDragStop.bind(this),isInterestedIn:this.isInterestedIn.bind(this)},this.beans.dragAndDropService.addDropTarget(this.dropTarget)},o.prototype.isInterestedIn=function(t){return t===e.DragSourceType.HeaderCell||t===e.DragSourceType.ToolPanel},o.prototype.checkInsertIndex=function(t){var e=this.horizontal?this.getNewHorizontalInsertIndex(t):this.getNewVerticalInsertIndex(t);if(e<0)return!1;var o=e!==this.insertIndex;return o&&(this.insertIndex=e),o},o.prototype.getNewHorizontalInsertIndex=function(t){if(e._.missing(t.hDirection))return-1;var o=0,n=t.event,r=this.beans.gridOptionsWrapper.isEnableRtl(),i=t.hDirection===e.HorizontalDirection.Left,a=n.clientX;return this.childColumnComponents.forEach((function(t){var e=t.getGui().getBoundingClientRect(),n=i?e.right:e.left;(r?a<=n:a>=n)&&o++})),o},o.prototype.getNewVerticalInsertIndex=function(t){if(e._.missing(t.vDirection))return-1;var o=0,n=t.event;return this.childColumnComponents.forEach((function(r){var i=r.getGui().getBoundingClientRect();n.clientY>=(t.vDirection===e.VerticalDirection.Down?i.top:i.bottom)&&o++})),o},o.prototype.checkDragStartedBySelf=function(t){this.state===o.STATE_NOT_DRAGGING&&(this.state=o.STATE_REARRANGE_COLUMNS,this.potentialDndColumns=t.dragSource.getDragItem().columns||[],this.refreshGui(),this.checkInsertIndex(t),this.refreshGui())},o.prototype.onDragging=function(t){this.checkDragStartedBySelf(t),this.checkInsertIndex(t)&&this.refreshGui()},o.prototype.onDragEnter=function(t){var e=t.dragSource.getDragItem().columns||[];this.state=o.STATE_NEW_COLUMNS_IN;var n=e.filter(this.isColumnDroppable.bind(this));n.length>0&&(this.potentialDndColumns=n,this.checkInsertIndex(t),this.refreshGui())},o.prototype.isPotentialDndColumns=function(){return e._.existsAndNotEmpty(this.potentialDndColumns)},o.prototype.onDragLeave=function(t){if(this.state===o.STATE_REARRANGE_COLUMNS){var e=t.dragSource.getDragItem().columns||[];this.removeColumns(e)}this.isPotentialDndColumns()&&(this.potentialDndColumns=[],this.refreshGui()),this.state=o.STATE_NOT_DRAGGING},o.prototype.onDragStop=function(){if(this.isPotentialDndColumns()){var t=!1;this.state===o.STATE_NEW_COLUMNS_IN?(this.addColumns(this.potentialDndColumns),t=!0):t=this.rearrangeColumns(this.potentialDndColumns),this.potentialDndColumns=[],this.beans.gridOptionsWrapper.isFunctionsPassive()&&t||this.refreshGui()}this.state=o.STATE_NOT_DRAGGING},o.prototype.removeColumns=function(t){var o=this.getExistingColumns().filter((function(o){return!e._.includes(t,o)}));this.updateColumns(o)},o.prototype.addColumns=function(t){if(t){var o=this.getExistingColumns().slice(),n=t.filter((function(t){return o.indexOf(t)<0}));e._.insertArrayIntoArray(o,n,this.insertIndex),this.updateColumns(o)}},o.prototype.rearrangeColumns=function(t){var o=this.getNonGhostColumns().slice();return e._.insertArrayIntoArray(o,t,this.insertIndex),!e._.areEqual(o,this.getExistingColumns())&&(this.updateColumns(o),!0)},o.prototype.refreshGui=function(){var t=this.eColumnDropList.scrollTop,e=this.resizeEnabled;this.toggleResizable(!1),this.destroyGui(),this.addIconAndTitleToGui(),this.addEmptyMessageToGui(),this.addColumnsToGui(),this.isHorizontal()||(this.eColumnDropList.scrollTop=t),e&&this.toggleResizable(e)},o.prototype.getNonGhostColumns=function(){var t=this,o=this.getExistingColumns();return this.isPotentialDndColumns()?o.filter((function(o){return!e._.includes(t.potentialDndColumns,o)})):o},o.prototype.addColumnsToGui=function(){var t=this,e=this.getNonGhostColumns(),o=this.isPotentialDndColumns(),n=[];e.forEach((function(e,r){if(!(o&&r>=t.insertIndex)){var i=t.createColumnComponent(e,!1);n.push(i)}})),this.isPotentialDndColumns()&&(this.potentialDndColumns.forEach((function(e){var o=t.createColumnComponent(e,!0);n.push(o)})),e.forEach((function(e,o){if(!(o<t.insertIndex)){var r=t.createColumnComponent(e,!1);n.push(r)}}))),this.getGui().appendChild(this.eColumnDropList),n.forEach((function(e,o){o>0&&t.addArrow(t.eColumnDropList),t.eColumnDropList.appendChild(e.getGui())}))},o.prototype.createColumnComponent=function(t,e){var o=this,n=new T(t,this.dropTarget,e,this.valueColumn,this.horizontal);return n.addEventListener(T.EVENT_COLUMN_REMOVE,this.removeColumns.bind(this,[t])),this.beans.context.createBean(n),this.guiDestroyFunctions.push((function(){return o.destroyBean(n)})),e||this.childColumnComponents.push(n),n},o.prototype.addIconAndTitleToGui=function(){var t=this.params.icon,o=document.createElement("div");if(this.addElementClasses(o,"title-bar"),this.addElementClasses(t,"icon"),e._.addOrRemoveCssClass(this.getGui(),"ag-column-drop-empty",this.isExistingColumnsEmpty()),o.appendChild(t),!this.horizontal){var n=document.createElement("span");this.addElementClasses(n,"title"),n.innerHTML=this.params.title,o.appendChild(n)}this.getGui().appendChild(o)},o.prototype.isExistingColumnsEmpty=function(){return 0===this.getExistingColumns().length},o.prototype.addEmptyMessageToGui=function(){if(this.isExistingColumnsEmpty()&&!this.isPotentialDndColumns()){var t=document.createElement("span");t.innerHTML=this.params.emptyMessage,this.addElementClasses(t,"empty-message"),this.eColumnDropList.appendChild(t)}},o.prototype.addArrow=function(t){if(this.horizontal){var o=this.beans.gridOptionsWrapper.isEnableRtl(),n=e._.createIconNoSpan(o?"smallLeft":"smallRight",this.beans.gridOptionsWrapper);this.addElementClasses(n,"cell-separator"),t.appendChild(n)}},o.STATE_NOT_DRAGGING="notDragging",o.STATE_NEW_COLUMNS_IN="newColumnsIn",o.STATE_REARRANGE_COLUMNS="rearrangeColumns",o}(e.Component),I=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),R=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},x=function(t){function o(e){return t.call(this,e,!1)||this}return I(o,t),o.prototype.passBeansUp=function(){t.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.gridOptionsWrapper.getLocaleTextFunc(),n=o("rowGroupColumnsEmptyMessage","Drag here to set row groups"),r=o("groups","Row Groups");t.prototype.init.call(this,{dragAndDropIcon:e.DragAndDropService.ICON_GROUP,icon:e._.createIconNoSpan("rowGroupPanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,e.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.refreshGui.bind(this))},o.prototype.getTooltipParams=function(){var e=t.prototype.getTooltipParams.call(this);return e.location="rowGroupColumnsList",e},o.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowRowGroup()&&!t.isRowGroupActive())},o.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var o={type:e.Events.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(o)}else this.columnModel.setRowGroupColumns(t,"toolPanelUi")},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?e.DragAndDropService.ICON_GROUP:e.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.getExistingColumns=function(){return this.columnModel.getRowGroupColumns()},R([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),R([e.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),R([e.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),R([e.Autowired("columnApi")],o.prototype,"columnApi",void 0),R([e.Autowired("gridApi")],o.prototype,"gridApi",void 0),R([e.PostConstruct],o.prototype,"passBeansUp",null),o}(F),L=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),V=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},W=function(t){function o(e){return t.call(this,e,!1)||this}return L(o,t),o.prototype.passBeansUp=function(){t.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.gridOptionsWrapper.getLocaleTextFunc(),n=o("pivotColumnsEmptyMessage","Drag here to set column labels"),r=o("pivots","Column Labels");t.prototype.init.call(this,{dragAndDropIcon:e.DragAndDropService.ICON_GROUP,icon:e._.createIconNoSpan("pivotPanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,e.Events.EVENT_NEW_COLUMNS_LOADED,this.refresh.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_COLUMN_PIVOT_CHANGED,this.refresh.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.checkVisibility.bind(this)),this.refresh()},o.prototype.getTooltipParams=function(){var e=t.prototype.getTooltipParams.call(this);return e.location="pivotColumnsList",e},o.prototype.refresh=function(){this.checkVisibility(),this.refreshGui()},o.prototype.checkVisibility=function(){var t=this.columnModel.isPivotMode();if(this.isHorizontal())switch(this.gridOptionsWrapper.getPivotPanelShow()){case"always":this.setDisplayed(t);break;case"onlyWhenPivoting":var e=this.columnModel.isPivotActive();this.setDisplayed(t&&e);break;default:this.setDisplayed(!1)}else this.setDisplayed(t)},o.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowPivot()&&!t.isPivotActive())},o.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var o={type:e.Events.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(o)}else this.columnModel.setPivotColumns(t,"toolPanelUi")},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?e.DragAndDropService.ICON_PIVOT:e.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.getExistingColumns=function(){return this.columnModel.getPivotColumns()},V([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),V([e.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),V([e.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),V([e.Autowired("columnApi")],o.prototype,"columnApi",void 0),V([e.Autowired("gridApi")],o.prototype,"gridApi",void 0),V([e.PostConstruct],o.prototype,"passBeansUp",null),o}(F),U=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),j=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},k=function(t){function o(){return t.call(this)||this}return U(o,t),o.prototype.postConstruct=function(){this.setGui(this.createNorthPanel()),this.addManagedListener(this.eventService,e.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_NEW_COLUMNS_LOADED,this.onRowGroupChanged.bind(this)),this.onRowGroupChanged()},o.prototype.createNorthPanel=function(){var t=document.createElement("div"),o=this.onDropPanelVisible.bind(this);return e._.addCssClass(t,"ag-column-drop-wrapper"),this.rowGroupComp=new x(!0),this.createManagedBean(this.rowGroupComp),this.pivotComp=new W(!0),this.createManagedBean(this.pivotComp),t.appendChild(this.rowGroupComp.getGui()),t.appendChild(this.pivotComp.getGui()),this.addManagedListener(this.rowGroupComp,e.Component.EVENT_DISPLAYED_CHANGED,o),this.addManagedListener(this.pivotComp,e.Component.EVENT_DISPLAYED_CHANGED,o),this.onDropPanelVisible(),t},o.prototype.onDropPanelVisible=function(){var t=this.rowGroupComp.isDisplayed()&&this.pivotComp.isDisplayed();this.rowGroupComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t),this.pivotComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t)},o.prototype.onRowGroupChanged=function(){if(this.rowGroupComp){var t=this.gridOptionsWrapper.getRowGroupPanelShow();if(t===e.Constants.ALWAYS)this.rowGroupComp.setDisplayed(!0);else if(t===e.Constants.ONLY_WHEN_GROUPING){var o=!this.columnModel.isRowGroupEmpty();this.rowGroupComp.setDisplayed(o)}else this.rowGroupComp.setDisplayed(!1)}},j([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),j([e.PostConstruct],o.prototype,"postConstruct",null),o}(e.Component),B={moduleName:e.ModuleNames.RowGroupingModule,beans:[i,p,h,v,A],agStackComponents:[{componentName:"AgGridHeaderDropZones",componentClass:k}],dependantModules:[o.EnterpriseCoreModule]},H=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),z=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},q=function(t){function o(e){return t.call(this,e,!0)||this}return H(o,t),o.prototype.passBeansUp=function(){t.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.gridOptionsWrapper.getLocaleTextFunc(),n=o("valueColumnsEmptyMessage","Drag here to aggregate"),r=o("values","Values");t.prototype.init.call(this,{dragAndDropIcon:e.DragAndDropService.ICON_AGGREGATE,icon:e._.createIconNoSpan("valuePanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,e.Events.EVENT_COLUMN_VALUE_CHANGED,this.refreshGui.bind(this))},o.prototype.getTooltipParams=function(){var e=t.prototype.getTooltipParams.call(this);return e.location="valueColumnsList",e},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?e.DragAndDropService.ICON_AGGREGATE:e.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowValue()&&!t.isValueActive())},o.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var o={type:e.Events.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(o)}else this.columnModel.setValueColumns(t,"toolPanelUi")},o.prototype.getExistingColumns=function(){return this.columnModel.getValueColumns()},z([e.Autowired("columnModel")],o.prototype,"columnModel",void 0),z([e.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),z([e.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),z([e.Autowired("columnApi")],o.prototype,"columnApi",void 0),z([e.Autowired("gridApi")],o.prototype,"gridApi",void 0),z([e.PostConstruct],o.prototype,"passBeansUp",null),o}(F);exports.PivotDropZonePanel=W,exports.RowGroupDropZonePanel=x,exports.RowGroupingModule=B,exports.ValuesDropZonePanel=q;