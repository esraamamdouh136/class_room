import { IsNullOrEmpty } from './helpers.class';
import { FileUploadTypes } from './file-types.class';
/**
 * function used to check file size
 */
const checkFileSize = (file, maxSize, minSize = 0) => {
    return (!IsNullOrEmpty(maxSize) && file.size > maxSize) || file.size < minSize ?
        { maxSize, minSize, actual: file.size, file } : null;
};
const ɵ0 = checkFileSize;
const getFileType = (file, fileExtension) => {
    const type = file.type;
    if (!IsNullOrEmpty(type)) {
        return type;
    }
    return FileUploadTypes[fileExtension];
};
const ɵ1 = getFileType;
const FILE_EXT_REG = /(^[.]\w*)$/m;
/**
 * function used to check file type
 *
 * #### allowedTypes
 * file_extension|audio/*|video/*|image/*|media_type
 */
const checkFileType = (file, allowedTypes) => {
    const fileExtension = file.name.split('.').pop().toLowerCase();
    const fileType = getFileType(file, fileExtension);
    for (const type of allowedTypes) {
        const isValid = FILE_EXT_REG.test(type) ? type === `.${fileExtension}` : new RegExp(type).test(fileType);
        if (isValid) {
            return null;
        }
    }
    return { allowedTypes, actual: file.type, file };
};
const ɵ2 = checkFileType;
const checkValueType = (value) => {
    if (!Array.isArray(value)) {
        throw Error(`FormControl.setValue was provided with wrong argument type, ${value} was provided instead Array<File>`);
    }
};
const ɵ3 = checkValueType;
// @dynamic
export class FileUploadValidators {
    /**
     * Validator that requires controls to have a file maximum size length.
     * Compare the File size in bytes
     * @dynamic
     */
    static fileSize(maxSize) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const toLargeFiles = files.map((file) => checkFileSize(file, maxSize))
                .filter((error) => error);
            return toLargeFiles.length > 0 ?
                { 'fileSize': toLargeFiles } : null;
        };
    }
    /**
     * Compare the File size in bytes with max and min size limits
     * @dynamic
     */
    static sizeRange({ minSize, maxSize }) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const sizeMismatch = files.map((file) => checkFileSize(file, maxSize, minSize))
                .filter((error) => error);
            return sizeMismatch.length > 0 ?
                { 'sizeRange': sizeMismatch } : null;
        };
    }
    /**
     * validator that requires control to have limit on files number
     * @dynamic
     */
    static filesLimit(numFiles) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const filesLimit = files.slice(-1 * (files.length - numFiles))
                .map(file => ({ 'max': numFiles, 'actual': files.length, file }));
            return files.length > numFiles ?
                { 'filesLimit': filesLimit } : null;
        };
    }
    /**
     * validator that requires control to have limit on media types
     *
     * ##### Allowed media types are
     *
     * - file_extension - a file extension starting with the STOP character,
     * e.g: .gif, .jpg, .png, .doc
     * - audio/* -        All sound files are accepted
     * - video/* -        All video files are accepted
     * - image/* -        All image files are accepted
     * - media_type -     A valid media type, with no parameters. Look at [IANA Media Types](https://www.iana.org/assignments/media-types/media-types.xhtml) for a complete list of standard media types
     *
     * #### Example
     * `FileUploadValidators.accept([file_extension, audio/*, video/*, image/*, media_type])`
     * @dynamic
     */
    static accept(allowedFileTypes) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const notAllowedFiles = files.map((file) => checkFileType(file, allowedFileTypes))
                .filter((error) => error);
            return notAllowedFiles.length > 0 ?
                { 'fileTypes': notAllowedFiles } : null;
        };
    }
}
export { ɵ0, ɵ1, ɵ2, ɵ3 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9ycy5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lwbGFiL25neC1maWxlLXVwbG9hZC9zcmMvbGliL2hlbHBlcnMvdmFsaWRhdG9ycy5jbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBY3JEOztHQUVHO0FBQ0gsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFVLEVBQUUsT0FBZSxFQUFFLFVBQWtCLENBQUMsRUFBMkIsRUFBRTtJQUNoRyxPQUFPLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxDQUFDO1FBQzVFLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzNELENBQUMsQ0FBQzs7QUFFRixNQUFNLFdBQVcsR0FBRyxDQUFDLElBQVUsRUFBRSxhQUFxQixFQUFtQixFQUFFO0lBQ3ZFLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUN0QixPQUFPLElBQXVCLENBQUM7S0FDbEM7SUFFRCxPQUFPLGVBQWUsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMxQyxDQUFDLENBQUM7O0FBRUYsTUFBTSxZQUFZLEdBQUcsYUFBYSxDQUFDO0FBQ25DOzs7OztHQUtHO0FBQ0gsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFVLEVBQUUsWUFBMkIsRUFBMkIsRUFBRTtJQUN2RixNQUFNLGFBQWEsR0FB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ZUFBZSxFQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUM5QyxDQUFDLENBQUM7SUFDTixDQUFDO0NBRUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IElzTnVsbE9yRW1wdHkgfSBmcm9tICcuL2hlbHBlcnMuY2xhc3MnO1xyXG5pbXBvcnQgeyBGaWxlVXBsb2FkQ29udHJvbCB9IGZyb20gJy4vY29udHJvbC5jbGFzcyc7XHJcbmltcG9ydCB7IEZpbGVVcGxvYWRUeXBlcyB9IGZyb20gJy4vZmlsZS10eXBlcy5jbGFzcyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25FcnJvciB7XHJcbiAgICBhY3R1YWw6IGFueTtcclxuICAgIGZpbGU6IEZpbGU7XHJcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvbkVycm9ycyB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlICBWYWxpZGF0b3JGbiA9IChjOiBBYnN0cmFjdENvbnRyb2wgfCBGaWxlVXBsb2FkQ29udHJvbCkgPT4gVmFsaWRhdGlvbkVycm9ycyB8IG51bGw7XHJcblxyXG4vKipcclxuICogZnVuY3Rpb24gdXNlZCB0byBjaGVjayBmaWxlIHNpemVcclxuICovXHJcbmNvbnN0IGNoZWNrRmlsZVNpemUgPSAoZmlsZTogRmlsZSwgbWF4U2l6ZTogbnVtYmVyLCBtaW5TaXplOiBudW1iZXIgPSAwKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xyXG4gICAgcmV0dXJuICghSXNOdWxsT3JFbXB0eShtYXhTaXplKSAmJiBmaWxlLnNpemUgPiBtYXhTaXplKSB8fCBmaWxlLnNpemUgPCBtaW5TaXplID9cclxuICAgICAgICB7bWF4U2l6ZSwgbWluU2l6ZSwgYWN0dWFsOiBmaWxlLnNpemUsIGZpbGV9IDogbnVsbDtcclxufTtcclxuXHJcbmNvbnN0IGdldEZpbGVUeXBlID0gKGZpbGU6IEZpbGUsIGZpbGVFeHRlbnNpb246IHN0cmluZyk6IEZpbGVVcGxvYWRUeXBlcyA9PiB7XHJcbiAgICBjb25zdCB0eXBlID0gZmlsZS50eXBlO1xyXG4gICAgaWYgKCFJc051bGxPckVtcHR5KHR5cGUpKSB7XHJcbiAgICAgICAgcmV0dXJuIHR5cGUgYXMgRmlsZVVwbG9hZFR5cGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBGaWxlVXBsb2FkVHlwZXNbZmlsZUV4dGVuc2lvbl07XHJcbn07XHJcblxyXG5jb25zdCBGSUxFX0VYVF9SRUcgPSAvKF5bLl1cXHcqKSQvbTtcclxuLyoqXHJcbiAqIGZ1bmN0aW9uIHVzZWQgdG8gY2hlY2sgZmlsZSB0eXBlXHJcbiAqXHJcbiAqICMjIyMgYWxsb3dlZFR5cGVzXHJcbiAqIGZpbGVfZXh0ZW5zaW9ufGF1ZGlvLyp8dmlkZW8vKnxpbWFnZS8qfG1lZGlhX3R5cGVcclxuICovXHJcbmNvbnN0IGNoZWNrRmlsZVR5cGUgPSAoZmlsZTogRmlsZSwgYWxsb3dlZFR5cGVzOiBBcnJheTxzdHJpbmc+KTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xyXG4gICAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCBmaWxlVHlwZSA9IGdldEZpbGVUeXBlKGZpbGUsIGZpbGVFeHRlbnNpb24pO1xyXG5cclxuICAgIGZvciAoY29uc3QgdHlwZSBvZiBhbGxvd2VkVHlwZXMgKSB7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IEZJTEVfRVhUX1JFRy50ZXN0KHR5cGUpID8gdHlwZSA9PT0gYC4ke2ZpbGVFeHRlbnNpb259YCA6IG5ldyBSZWdFeHAodHlwZSkudGVzdChmaWxlVHlwZSk7XHJcbiAgICAgICAgaWYgKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7YWxsb3dlZFR5cGVzLCBhY3R1YWw6IGZpbGUudHlwZSwgZmlsZX07XHJcbn07XHJcblxyXG5jb25zdCBjaGVja1ZhbHVlVHlwZSA9ICh2YWx1ZTogYW55ICk6IHZvaWQgPT4ge1xyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgIHRocm93IEVycm9yKGBGb3JtQ29udHJvbC5zZXRWYWx1ZSB3YXMgcHJvdmlkZWQgd2l0aCB3cm9uZyBhcmd1bWVudCB0eXBlLCAke3ZhbHVlfSB3YXMgcHJvdmlkZWQgaW5zdGVhZCBBcnJheTxGaWxlPmApO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGR5bmFtaWNcclxuZXhwb3J0IGNsYXNzIEZpbGVVcGxvYWRWYWxpZGF0b3JzIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFZhbGlkYXRvciB0aGF0IHJlcXVpcmVzIGNvbnRyb2xzIHRvIGhhdmUgYSBmaWxlIG1heGltdW0gc2l6ZSBsZW5ndGguXHJcbiAgICAgKiBDb21wYXJlIHRoZSBGaWxlIHNpemUgaW4gYnl0ZXNcclxuICAgICAqIEBkeW5hbWljXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZmlsZVNpemUobWF4U2l6ZTogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sIHwgRmlsZVVwbG9hZENvbnRyb2wpOiB7ZmlsZVNpemU6IEFycmF5PFZhbGlkYXRpb25FcnJvcnM+fSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzOiBBcnJheTxGaWxlPiA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChJc051bGxPckVtcHR5KGZpbGVzKSkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgICAgICBjaGVja1ZhbHVlVHlwZShmaWxlcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0b0xhcmdlRmlsZXMgPSBmaWxlcy5tYXAoKGZpbGUpID0+IGNoZWNrRmlsZVNpemUoZmlsZSwgbWF4U2l6ZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlcnJvcikgPT4gZXJyb3IpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRvTGFyZ2VGaWxlcy5sZW5ndGggPiAwID9cclxuICAgICAgICAgICAgICAgICAgICB7J2ZpbGVTaXplJzogdG9MYXJnZUZpbGVzfSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbXBhcmUgdGhlIEZpbGUgc2l6ZSBpbiBieXRlcyB3aXRoIG1heCBhbmQgbWluIHNpemUgbGltaXRzXHJcbiAgICAgKiBAZHluYW1pY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNpemVSYW5nZSh7IG1pblNpemUsIG1heFNpemUgfTogeyBtaW5TaXplPzogbnVtYmVyOyBtYXhTaXplPzogbnVtYmVyIH0pOiBWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wgfCBGaWxlVXBsb2FkQ29udHJvbCk6IHtzaXplUmFuZ2U6IEFycmF5PFZhbGlkYXRpb25FcnJvcnM+fSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzOiBBcnJheTxGaWxlPiA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChJc051bGxPckVtcHR5KGZpbGVzKSkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgICAgICBjaGVja1ZhbHVlVHlwZShmaWxlcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzaXplTWlzbWF0Y2ggPSBmaWxlcy5tYXAoKGZpbGUpID0+IGNoZWNrRmlsZVNpemUoZmlsZSwgbWF4U2l6ZSwgbWluU2l6ZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlcnJvcikgPT4gZXJyb3IpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHNpemVNaXNtYXRjaC5sZW5ndGggPiAwID9cclxuICAgICAgICAgICAgICAgICAgICB7J3NpemVSYW5nZSc6IHNpemVNaXNtYXRjaH0gOiBudWxsO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB2YWxpZGF0b3IgdGhhdCByZXF1aXJlcyBjb250cm9sIHRvIGhhdmUgbGltaXQgb24gZmlsZXMgbnVtYmVyXHJcbiAgICAgKiBAZHluYW1pY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbGVzTGltaXQobnVtRmlsZXM6IG51bWJlcik6IFZhbGlkYXRvckZuIHtcclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCB8IEZpbGVVcGxvYWRDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzOiBBcnJheTxGaWxlPiA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChJc051bGxPckVtcHR5KGZpbGVzKSkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgICAgICBjaGVja1ZhbHVlVHlwZShmaWxlcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBmaWxlc0xpbWl0ID0gZmlsZXMuc2xpY2UoLTEgKiAoZmlsZXMubGVuZ3RoIC0gbnVtRmlsZXMpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKGZpbGUgPT4gKHsnbWF4JzogbnVtRmlsZXMsICdhY3R1YWwnOiBmaWxlcy5sZW5ndGgsIGZpbGUgfSkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZpbGVzLmxlbmd0aCA+IG51bUZpbGVzID9cclxuICAgICAgICAgICAgICAgIHsnZmlsZXNMaW1pdCc6IGZpbGVzTGltaXR9IDogbnVsbDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogdmFsaWRhdG9yIHRoYXQgcmVxdWlyZXMgY29udHJvbCB0byBoYXZlIGxpbWl0IG9uIG1lZGlhIHR5cGVzXHJcbiAgICAgKlxyXG4gICAgICogIyMjIyMgQWxsb3dlZCBtZWRpYSB0eXBlcyBhcmVcclxuICAgICAqXHJcbiAgICAgKiAtIGZpbGVfZXh0ZW5zaW9uIC0gYSBmaWxlIGV4dGVuc2lvbiBzdGFydGluZyB3aXRoIHRoZSBTVE9QIGNoYXJhY3RlcixcclxuICAgICAqIGUuZzogLmdpZiwgLmpwZywgLnBuZywgLmRvY1xyXG4gICAgICogLSBhdWRpby8qIC0gICAgICAgIEFsbCBzb3VuZCBmaWxlcyBhcmUgYWNjZXB0ZWRcclxuICAgICAqIC0gdmlkZW8vKiAtICAgICAgICBBbGwgdmlkZW8gZmlsZXMgYXJlIGFjY2VwdGVkXHJcbiAgICAgKiAtIGltYWdlLyogLSAgICAgICAgQWxsIGltYWdlIGZpbGVzIGFyZSBhY2NlcHRlZFxyXG4gICAgICogLSBtZWRpYV90eXBlIC0gICAgIEEgdmFsaWQgbWVkaWEgdHlwZSwgd2l0aCBubyBwYXJhbWV0ZXJzLiBMb29rIGF0IFtJQU5BIE1lZGlhIFR5cGVzXShodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy9tZWRpYS10eXBlcy54aHRtbCkgZm9yIGEgY29tcGxldGUgbGlzdCBvZiBzdGFuZGFyZCBtZWRpYSB0eXBlc1xyXG4gICAgICpcclxuICAgICAqICMjIyMgRXhhbXBsZVxyXG4gICAgICogYEZpbGVVcGxvYWRWYWxpZGF0b3JzLmFjY2VwdChbZmlsZV9leHRlbnNpb24sIGF1ZGlvLyosIHZpZGVvLyosIGltYWdlLyosIG1lZGlhX3R5cGVdKWBcclxuICAgICAqIEBkeW5hbWljXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYWNjZXB0KGFsbG93ZWRGaWxlVHlwZXM6IEFycmF5PHN0cmluZz4pIHtcclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCB8IEZpbGVVcGxvYWRDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzOiBBcnJheTxGaWxlPiA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgIGlmIChJc051bGxPckVtcHR5KGZpbGVzKSkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgICAgICBjaGVja1ZhbHVlVHlwZShmaWxlcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBub3RBbGxvd2VkRmlsZXMgPSBmaWxlcy5tYXAoKGZpbGUpID0+IGNoZWNrRmlsZVR5cGUoZmlsZSwgYWxsb3dlZEZpbGVUeXBlcykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlcnJvcikgPT4gZXJyb3IpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5vdEFsbG93ZWRGaWxlcy5sZW5ndGggPiAwID9cclxuICAgICAgICAgICAgICAgIHsnZmlsZVR5cGVzJzogbm90QWxsb3dlZEZpbGVzfSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn1cclxuIl19